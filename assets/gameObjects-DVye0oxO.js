import{e as a,d as p,g as y,T as c,a as f,i as u,h as d,W as x,b as w}from"./card-Kmwn0JuI.js";const k=[{suit:a.CRACK,textArray:["Crack"],prefix:["C"],maxNum:9,count:4},{suit:a.BAM,textArray:["Bam"],prefix:["B"],maxNum:9,count:4},{suit:a.DOT,textArray:["Dot"],prefix:["D"],maxNum:9,count:4},{suit:a.WIND,textArray:["North","South","West","East"],prefix:["N","S","W","E"],maxNum:1,count:4},{suit:a.DRAGON,textArray:["Red dragon","Green dragon","White dragon"],prefix:["DC","DB","DD"],maxNum:1,count:4},{suit:a.FLOWER,textArray:["Flower"],prefix:["F1","F2","F3","F4","F1","F2","F3","F4"],maxNum:1,count:1},{suit:a.JOKER,textArray:["Joker"],prefix:"J",maxNum:1,count:8},{suit:a.BLANK,textArray:["Blank"],prefix:["BLANK"],maxNum:1,count:8}];class A{constructor(t,e,s,i){this.scene=t,this.suit=e,this.number=s,this.sprite=null,this.spriteName=i,this.origX=0,this.origY=0,this.selected=!1,this.tween=null,this.glowEffect=null,this.glowColor=16711680,this.glowIntensity=.6,this.glowPriority=0}create(){this.suit===a.BLANK?this.sprite=this.scene.add.sprite(0,0,"back"):this.sprite=this.scene.add.sprite(0,0,"tiles",this.spriteName),this.sprite.visible=!1,this.sprite.setOrigin(.5,.5),this.spriteBack=this.scene.add.sprite(0,0,"back"),this.spriteBack.visible=!1,this.spriteBack.setOrigin(.5,.5);const t=this.scene.add.graphics();t.fillStyle(16777215);let e=u,s=f;const i=6;(this.sprite.scaleX<1||this.sprite.scaleY<1)&&(e=u-c,s=f-c),t.fillRoundedRect(-e/2,-s/2,e,s,i);const r=t.createGeometryMask();this.sprite.setMask(r),this.spriteBack.setMask(r),this.mask=r}get x(){return this.sprite.x}get y(){return this.sprite.y}get angle(){return this.sprite.angle}set x(t){this.sprite.x=t,this.spriteBack.x=t,this.mask&&(this.mask.geometryMask.x=t)}set y(t){this.sprite.y=t,this.spriteBack.y=t,this.mask&&(this.mask.geometryMask.y=t)}set angle(t){this.sprite.angle=t,this.spriteBack.angle=t,this.mask&&this.mask.geometryMask&&(this.mask.geometryMask.angle=t)}get scale(){return this.sprite.scale}set scale(t){this.sprite.setScale(t),this.spriteBack.setScale(t),this.mask&&this.mask.geometryMask&&this.mask.geometryMask.setScale(t),this.updateGlowPosition()}animate(t,e,s,i=null){if(p("Tile.animate called for:",this.getText(),"this.sprite:",this.sprite),!this.sprite||!this.sprite.scene){console.error("Tile.animate: this.sprite is undefined, null, or destroyed for tile:",this.getText());return}const r=1500,l=Math.hypot(t-this.sprite.x,e-this.sprite.y),h=i!==null?i:l*1e3/r;return this.tween&&this.tween.stop(),this.withRaisedDepth(()=>{const o={targets:this.sprite,x:t,y:e,duration:h,ease:"Linear",onUpdate:()=>{this.spriteBack.x=this.sprite.x,this.spriteBack.y=this.sprite.y,this.spriteBack.angle=this.sprite.angle,this.mask&&this.mask.geometryMask&&(this.mask.geometryMask.x=this.sprite.x,this.mask.geometryMask.y=this.sprite.y,this.mask.geometryMask.angle=this.sprite.angle),this.updateGlowPosition()},onComplete:()=>{this.sprite.x=t,this.sprite.y=e,this.sprite.angle=s,this.spriteBack.x=t,this.spriteBack.y=e,this.spriteBack.angle=s,this.mask&&this.mask.geometryMask&&(this.mask.geometryMask.x=t,this.mask.geometryMask.y=e,this.mask.geometryMask.angle=s),this.tween=null,this.updateGlowPosition()}};return d.Math.Angle.Wrap(this.sprite.angle)!==d.Math.Angle.Wrap(s)&&(o.angle=s),this.tween=this.scene.tweens.add(o),this.tween})}withRaisedDepth(t){const e=Math.max(1,this.sprite.depth),s=100;this._raisedDepthCount=(this._raisedDepthCount??0)+1;const i=e+s;this.sprite.depth=i,this.spriteBack.depth=i,this.glowEffect&&this.glowEffect.setDepth(i-1);const r=t(i);return r.once("complete",()=>{this._raisedDepthCount-=1,this._raisedDepthCount===0&&(this.sprite.depth=e,this.spriteBack.depth=e,this.glowEffect&&this.glowEffect.setDepth(e-1))}),r}tweenUpdateCallback(){this.spriteBack.x=this.sprite.x,this.spriteBack.y=this.sprite.y,this.spriteBack.angle=this.sprite.angle}showTile(t,e){this.sprite.visible=!1,this.spriteBack.visible=!1,t&&(e?this.sprite.visible=!0:this.spriteBack.visible=!0),this.updateGlowPosition()}getText(){if(this.suit===a.INVALID)return"Invalid";const t=k[this.suit];let e=null;return t.textArray.length===1?e=t.textArray[0]:e=t.textArray[this.number],t.maxNum!==1&&(e=this.number+" "+e),e}addGlowEffect(t,e=16711680,s=.6,i=0){this.glowEffect&&this.glowPriority>i||(this.removeGlowEffect(),this.glowColor=e,this.glowIntensity=s,this.glowPriority=i,this.glowEffect=t.add.graphics(),this.updateGlowPosition(),this.glowEffect.setDepth(this.sprite.depth-1))}updateGlowPosition(){if(!this.glowEffect)return;if(this.glowEffect.clear(),!this.sprite.visible){this.glowEffect.setVisible(!1);return}this.glowEffect.setVisible(!0),this.glowEffect.fillStyle(this.glowColor,this.glowIntensity);const t=this.sprite.getBounds(),e=8,s=this.sprite.scaleX,i=e*s;this.glowEffect.fillRoundedRect(t.x-i/2,t.y-i/2,t.width+i,t.height+i,10*s),this.glowEffect.setDepth(this.sprite.depth-1)}removeGlowEffect(){this.glowEffect&&(this.glowEffect.destroy(),this.glowEffect=null,this.glowPriority=0)}}class b{constructor(t){this.scene=t,this.tileArray=[]}create(t=!1){if(!t){for(const e of k)for(const s of e.prefix)for(let i=1;i<=e.maxNum;i++){let r=i;e.maxNum===1&&(e.suit===a.FLOWER?r=0:r=e.prefix.indexOf(s));let l=s;e.maxNum!==1&&(l=i+l),l+=".png";for(let h=0;h<e.count;h++){const o=new A(this.scene,e.suit,r,l);o.create(),this.insert(o)}}p("Wall.create: Number of tiles = "+this.tileArray.length)}}destroy(){}receiveOrganizedTilesFromHomePage(t){return new Promise((e,s)=>{const i=y();if(t.length!==i)return console.error("Wall.receiveOrganizedTilesFromHomePage: Invalid tile count. Expected "+i+", got "+t.length),s("Invalid tile count");this.tileArray.length>0&&(this.tileArray=[]),this.tileArray=t,p("Wall received "+t.length+" tiles from HomePageTileManager."),e()})}getCount(){return this.tileArray.length}findAndRemove(t){for(const e of this.tileArray)if(e.suit===t.suit&&e.number===t.number){const s=this.tileArray.indexOf(e);return this.tileArray.splice(s,1),e}return null}insert(t){t.showTile(!1,!1),this.tileArray.push(t)}remove(){return this.tileArray.pop()}shuffle(){const t=this.tileArray;for(let e=t.length-1;e>0;e-=1){const s=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[s],t[s]=i}}}class D{constructor(){this.tileArray=[],this.selectionEnabled=!1,this.selectionCallback=null}insertDiscard(t){this.tileArray.push(t)}showDiscards(){if(this.tileArray.length===0)return;const t=x/2,e=w/2-100,s=.5,i=17,r=u*s+c,l=Math.min(this.tileArray.length,i)*r-c;let h=t-l/2,o=e,m=0;for(const n of this.tileArray)n.animate(h,o,0),n.scale=s,n.showTile(!0,!0),n.sprite.depth=50,n.spriteBack.depth=50,h+=r,++m>=i&&(m=0,h=t-l/2,o+=f*s+c)}getSelectableDiscards(){return this.tileArray.filter(t=>t.suit!==a.JOKER)}enableDiscardSelection(t){this.selectionEnabled=!0,this.selectionCallback=t;for(const e of this.getSelectableDiscards())e.sprite.setInteractive(),e.sprite.on("pointerup",()=>{this.selectionEnabled&&this.selectionCallback&&this.selectionCallback(e)}),e.sprite.setTint(16776960)}disableDiscardSelection(){this.selectionEnabled=!1,this.selectionCallback=null;for(const t of this.tileArray)t.sprite&&(t.sprite.clearTint(),t.sprite.removeInteractive(),t.sprite.off("pointerup"))}removeDiscardTile(t){const e=this.tileArray.indexOf(t);return e>-1&&this.tileArray.splice(e,1),t}}export{D,A as T,b as W,k as g};
