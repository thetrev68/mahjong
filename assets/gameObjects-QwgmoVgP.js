import{e as a,d as u,g as E,i as g,a as m,h as y,T as c,b as D,W as b}from"./card-B8vZ1bZK.js";const k=[{suit:a.CRACK,textArray:["Crack"],prefix:["C"],maxNum:9,count:4},{suit:a.BAM,textArray:["Bam"],prefix:["B"],maxNum:9,count:4},{suit:a.DOT,textArray:["Dot"],prefix:["D"],maxNum:9,count:4},{suit:a.WIND,textArray:["North","South","West","East"],prefix:["N","S","W","E"],maxNum:1,count:4},{suit:a.DRAGON,textArray:["Red dragon","Green dragon","White dragon"],prefix:["DC","DB","DD"],maxNum:1,count:4},{suit:a.FLOWER,textArray:["Flower"],prefix:["F1","F2","F3","F4","F1","F2","F3","F4"],maxNum:1,count:1},{suit:a.JOKER,textArray:["Joker"],prefix:"J",maxNum:1,count:8},{suit:a.BLANK,textArray:["Blank"],prefix:["BLANK"],maxNum:1,count:8}];class B{constructor(t,e,i,s){this.scene=t,this.suit=e,this.number=i,this.sprite=null,this.spriteName=s,this.origX=0,this.origY=0,this.selected=!1,this.tween=null,this.glowEffect=null,this.glowColor=16711680,this.glowIntensity=.6,this.glowPriority=0}create(){this.suit===a.BLANK?this.sprite=this.scene.add.sprite(0,0,"back"):this.sprite=this.scene.add.sprite(0,0,"tiles",this.spriteName),this.sprite.visible=!1,this.sprite.setOrigin(.5,.5),this.spriteBack=this.scene.add.sprite(0,0,"back"),this.spriteBack.visible=!1,this.spriteBack.setOrigin(.5,.5);const t=this.scene.add.graphics();t.fillStyle(16777215);let e=g,i=m;const s=6;(this.sprite.scaleX<1||this.sprite.scaleY<1)&&(e=g-c,i=m-c),t.fillRoundedRect(-e/2,-i/2,e,i,s);const r=t.createGeometryMask();this.sprite.setMask(r),this.spriteBack.setMask(r),this.mask=r}get x(){return this.sprite.x}get y(){return this.sprite.y}get angle(){return this.sprite.angle}set x(t){this.sprite.x=t,this.spriteBack.x=t,this.mask&&(this.mask.geometryMask.x=t)}set y(t){this.sprite.y=t,this.spriteBack.y=t,this.mask&&(this.mask.geometryMask.y=t)}set angle(t){this.sprite.angle=t,this.spriteBack.angle=t,this.mask&&this.mask.geometryMask&&(this.mask.geometryMask.angle=t)}get scale(){return this.sprite.scale}set scale(t){this.sprite.setScale(t),this.spriteBack.setScale(t),this.mask&&this.mask.geometryMask&&this.mask.geometryMask.setScale(t),this.updateGlowPosition()}animate(t,e,i,s=null){if(u("Tile.animate called for:",this.getText(),"this.sprite:",this.sprite),!this.sprite||!this.sprite.scene){console.error("Tile.animate: this.sprite is undefined, null, or destroyed for tile:",this.getText());return}const r=1500,o=Math.hypot(t-this.sprite.x,e-this.sprite.y),l=s!==null?s:o*1e3/r;return this.tween&&this.tween.stop(),this.withRaisedDepth(()=>{const n={targets:this.sprite,x:t,y:e,duration:l,ease:"Linear",onUpdate:()=>{this.spriteBack.x=this.sprite.x,this.spriteBack.y=this.sprite.y,this.spriteBack.angle=this.sprite.angle,this.mask&&this.mask.geometryMask&&(this.mask.geometryMask.x=this.sprite.x,this.mask.geometryMask.y=this.sprite.y,this.mask.geometryMask.angle=this.sprite.angle),this.updateGlowPosition()},onComplete:()=>{this.sprite.x=t,this.sprite.y=e,this.sprite.angle=i,this.spriteBack.x=t,this.spriteBack.y=e,this.spriteBack.angle=i,this.mask&&this.mask.geometryMask&&(this.mask.geometryMask.x=t,this.mask.geometryMask.y=e,this.mask.geometryMask.angle=i),this.tween=null,this.updateGlowPosition()}};return y.Math.Angle.Wrap(this.sprite.angle)!==y.Math.Angle.Wrap(i)&&(n.angle=i),this.tween=this.scene.tweens.add(n),this.tween})}withRaisedDepth(t){const e=Math.max(1,this.sprite.depth),i=100;this._raisedDepthCount=(this._raisedDepthCount??0)+1;const s=e+i;this.sprite.depth=s,this.spriteBack.depth=s,this.glowEffect&&this.glowEffect.setDepth(s-1);const r=t(s);return r.once("complete",()=>{this._raisedDepthCount-=1,this._raisedDepthCount===0&&(this.sprite.depth=e,this.spriteBack.depth=e,this.glowEffect&&this.glowEffect.setDepth(e-1))}),r}tweenUpdateCallback(){this.spriteBack.x=this.sprite.x,this.spriteBack.y=this.sprite.y,this.spriteBack.angle=this.sprite.angle}showTile(t,e){this.sprite.visible=!1,this.spriteBack.visible=!1,t&&(e?this.sprite.visible=!0:this.spriteBack.visible=!0),this.updateGlowPosition()}getText(){if(this.suit===a.INVALID)return"Invalid";const t=k[this.suit];let e=null;return t.textArray.length===1?e=t.textArray[0]:e=t.textArray[this.number],t.maxNum!==1&&(e=this.number+" "+e),e}addGlowEffect(t,e=16711680,i=.6,s=0){this.glowEffect&&this.glowPriority>s||(this.removeGlowEffect(),this.glowColor=e,this.glowIntensity=i,this.glowPriority=s,this.glowEffect=t.add.graphics(),this.updateGlowPosition(),this.glowEffect.setDepth(this.sprite.depth-1))}updateGlowPosition(){if(!this.glowEffect)return;if(this.glowEffect.clear(),!this.sprite.visible){this.glowEffect.setVisible(!1);return}this.glowEffect.setVisible(!0),this.glowEffect.fillStyle(this.glowColor,this.glowIntensity);const t=this.sprite.getBounds(),e=8,i=this.sprite.scaleX,s=e*i;this.glowEffect.fillRoundedRect(t.x-s/2,t.y-s/2,t.width+s,t.height+s,10*i),this.glowEffect.setDepth(this.sprite.depth-1)}removeGlowEffect(){this.glowEffect&&(this.glowEffect.destroy(),this.glowEffect=null,this.glowPriority=0)}}class M{constructor(t){this.scene=t,this.tileArray=[]}create(t=!1){var i,s;if(t)return;const e=((s=(i=window.settingsManager)==null?void 0:i.getUseBlankTiles)==null?void 0:s.call(i))||!1;for(const r of k)if(!(r.suit===a.BLANK&&!e))for(const o of r.prefix)for(let l=1;l<=r.maxNum;l++){let n=l;r.maxNum===1&&(r.suit===a.FLOWER?n=0:n=r.prefix.indexOf(o));let h=o;r.maxNum!==1&&(h=l+h),h+=".png";for(let p=0;p<r.count;p++){const f=new B(this.scene,r.suit,n,h);f.create(),this.insert(f)}}u("Wall.create: Number of tiles = "+this.tileArray.length)}destroy(){}receiveOrganizedTilesFromHomePage(t){return new Promise((e,i)=>{const s=E();if(t.length!==s)return console.error("Wall.receiveOrganizedTilesFromHomePage: Invalid tile count. Expected "+s+", got "+t.length),i("Invalid tile count");this.tileArray.length>0&&(this.tileArray=[]),this.tileArray=t,u("Wall received "+t.length+" tiles from HomePageTileManager."),e()})}getCount(){return this.tileArray.length}findAndRemove(t){for(const e of this.tileArray)if(e.suit===t.suit&&e.number===t.number){const i=this.tileArray.indexOf(e);return this.tileArray.splice(i,1),e}return null}insert(t){t.showTile(!1,!1),this.tileArray.push(t)}remove(){return this.tileArray.pop()}shuffle(){const t=this.tileArray;for(let e=t.length-1;e>0;e-=1){const i=Math.floor(Math.random()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}}}class R{constructor(){this.tileArray=[],this.selectionEnabled=!1,this.selectionCallback=null}insertDiscard(t){this.tileArray.push(t)}showDiscards(){this.tileArray.length!==0&&this.layoutTiles()}getSelectableDiscards(){return this.tileArray.filter(t=>t.suit!==a.JOKER)}enableDiscardSelection(t){this.selectionEnabled=!0,this.selectionCallback=t;for(const e of this.getSelectableDiscards())e.sprite.setInteractive(),e.sprite.on("pointerup",()=>{this.selectionEnabled&&this.selectionCallback&&this.selectionCallback(e)}),e.sprite.setTint(16776960)}disableDiscardSelection(){this.selectionEnabled=!1,this.selectionCallback=null;for(const t of this.tileArray)t.sprite&&(t.sprite.clearTint(),t.sprite.removeInteractive(),t.sprite.off("pointerup"))}removeDiscardTile(t){const e=this.tileArray.indexOf(t);return e>-1&&this.tileArray.splice(e,1),t}getTilePosition(t,e=this.tileArray.length){const r=g*.5+c,o=m*.5+c,l=b/2,n=D/2-100,h=Math.floor(t/17),p=t%17,w=Math.max(Math.min(e-h*17,17),1)*r-c,x=l-w/2+p*r,A=n+h*o;return{x,y:A,scale:.5}}layoutTiles(t=null){const e=this.tileArray.length;for(let i=0;i<e;i++){const s=this.tileArray[i];if(!s||s===t)continue;const{x:r,y:o,scale:l}=this.getTilePosition(i,e);s.scale=l,s.angle=0,s.x=r,s.y=o,s.showTile(!0,!0),s.sprite.depth=50,s.spriteBack.depth=50}}}export{R as D,B as T,M as W,k as g};
