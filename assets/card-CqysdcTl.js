(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function He(l){const e=window.document.getElementById("messages");if(!e)return;const t=l.endsWith(`
`)?l:`${l}
`;e.value+=t,e.scrollTop=e.scrollHeight}function Le(l){const e=window.document.getElementById("info");e.value=l}let I=function(){},re=function(){},ee=function(){},Ve=function(){};function Ue(l){const e=window.document.getElementById("hint-content");e.innerHTML=l}const x={cardYear:2025,useBlankTiles:!1,difficulty:"medium",trainingMode:!1,trainingHand:"",trainingTileCount:9,skipCharleston:!1,bgmVolume:20,bgmMuted:!1,sfxVolume:20,sfxMuted:!1},B="mahjong_";class Ge{static load(){const e={};for(const[t,n]of Object.entries(x)){const r=B+t,s=localStorage.getItem(r);s===null?e[t]=n:e[t]=this.parseValue(s,typeof n)}return e}static save(e){for(const[t,n]of Object.entries(e)){if(!(t in x)){console.warn(`Unknown setting key: ${t}`);continue}const r=B+t;localStorage.setItem(r,String(n))}}static get(e){if(!(e in x)){console.warn(`Unknown setting key: ${e}`);return}const t=B+e,n=localStorage.getItem(t);return n===null?x[e]:this.parseValue(n,typeof x[e])}static set(e,t){if(!(e in x)){console.warn(`Unknown setting key: ${e}`);return}const n=typeof x[e],r=typeof t;if(r!==n){console.error(`Type mismatch for ${e}: expected ${n}, got ${r}`);return}const s=B+e;localStorage.setItem(s,String(t))}static reset(){for(const e of Object.keys(x)){const t=B+e;localStorage.removeItem(t)}}static getDefault(e){return x[e]}static getDefaults(){return{...x}}static parseValue(e,t){switch(t){case"number":return parseInt(e,10);case"boolean":return e==="true";case"string":return e;default:return console.warn(`Unknown type: ${t}`),e}}static isAvailable(){try{const e="__storage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.error("localStorage is not available:",e),!1}}static exportJSON(){const e=this.load();return JSON.stringify(e,null,2)}static importJSON(e){try{const t=JSON.parse(e);for(const n of Object.keys(t))if(!(n in x))return console.error(`Invalid setting key in import: ${n}`),!1;return this.save(t),!0}catch(t){return console.error("Failed to import settings:",t),!1}}static subscribe(e,t){const n=r=>{if(r.key===B+e){const s=this.parseValue(r.newValue,typeof x[e]);t(s)}};return window.addEventListener("storage",n),()=>{window.removeEventListener("storage",n)}}}const Be=648,Ke=1052,Je=69,$e=52,We=.75,je=4,C={INIT:0,START:1,DEAL:2,CHARLESTON1:3,CHARLESTON_QUERY:4,CHARLESTON2:6,COURTESY_QUERY:7,COURTESY:9,COURTESY_COMPLETE:10,LOOP_PICK_FROM_WALL:11,LOOP_CHOOSE_DISCARD:12,LOOP_QUERY_CLAIM_DISCARD:13,LOOP_EXPOSE_TILES:15,LOOP_EXPOSE_TILES_COMPLETE:16,END:17},J={EXPOSE_TILES:0,DISCARD_TILE:1,MAHJONG:2},T={BOTTOM:0,RIGHT:1,TOP:2,LEFT:3},o={CRACK:0,BAM:1,DOT:2,WIND:3,DRAGON:4,FLOWER:5,JOKER:6,BLANK:7,VSUIT1:8,VSUIT2:9,VSUIT3:10,VSUIT1_DRAGON:11,VSUIT2_DRAGON:12,VSUIT3_DRAGON:13,INVALID:99},R={CONSECUTIVE1:10,CONSECUTIVE2:11,CONSECUTIVE3:12,CONSECUTIVE4:13,CONSECUTIVE5:14,CONSECUTIVE6:15,CONSECUTIVE7:16,INVALID:99},P={NORTH:0,SOUTH:1,WEST:2,EAST:3},O={RED:0,GREEN:1,WHITE:2},W={DISCARD_ANIMATION_HUMAN:300,DISCARD_ANIMATION_AI:200,TILE_DRAWN_DELAY:300,DISCARD_COMPLETE_DELAY:500},Fe={TILE_SELECTED_Y:575,TILE_NORMAL_Y:600};function Ye(){return!window.settingsManager||typeof window.settingsManager.getUseBlankTiles!="function"?152:window.settingsManager.getUseBlankTiles()?160:152}const te=[{suit:o.CRACK,textArray:["Crack"],prefix:["C"],maxNum:9,count:4},{suit:o.BAM,textArray:["Bam"],prefix:["B"],maxNum:9,count:4},{suit:o.DOT,textArray:["Dot"],prefix:["D"],maxNum:9,count:4},{suit:o.WIND,textArray:["North","South","West","East"],prefix:["N","S","W","E"],maxNum:1,count:4},{suit:o.DRAGON,textArray:["Red dragon","Green dragon","White dragon"],prefix:["DC","DB","DD"],maxNum:1,count:4},{suit:o.FLOWER,textArray:["Flower"],prefix:["F1","F2","F3","F4","F1","F2","F3","F4"],maxNum:1,count:1},{suit:o.JOKER,textArray:["Joker"],prefix:["J"],maxNum:1,count:8},{suit:o.BLANK,textArray:["Blank"],prefix:["BLANK"],maxNum:1,count:8}];class se{constructor(){this.listeners=new Map}on(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),()=>{const n=this.listeners.get(e);if(!n||n.length===0)return;const r=n.indexOf(t);r>-1&&(n.splice(r,1),n.length===0&&this.listeners.delete(e))}}once(e,t){const n=this.on(e,r=>{n(),t(r)})}emit(e,t){const n=this.listeners.get(e);n&&n.slice().forEach(r=>{try{r(t)}catch(s){console.error(`Error in event handler for ${e}:`,s)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}}class D{constructor(e,t,n=-1){this.suit=e,this.number=t,this.index=n}getText(){for(const e of te)if(e.suit===this.suit){if(this.suit<=o.DOT)return`${e.textArray[0]} ${this.number}`;if(this.suit===o.WIND)return`${e.textArray[this.number]} wind`;if(this.suit===o.DRAGON)return`${e.textArray[this.number]}`;if(this.suit===o.FLOWER)return`${e.textArray[0]} ${this.number+1}`;if(this.suit===o.JOKER)return"Joker";if(this.suit===o.BLANK)return"Blank"}return this.suit===o.INVALID?"Invalid":`Unknown tile (${this.suit}:${this.number})`}equals(e){return e?this.suit===e.suit&&this.number===e.number:!1}isSameTile(e){return e?this.index===e.index:!1}clone(){return new D(this.suit,this.number,this.index)}isJoker(){return this.suit===o.JOKER}isBlank(){return this.suit===o.BLANK}isFlower(){return this.suit===o.FLOWER}isWind(){return this.suit===o.WIND}isDragon(){return this.suit===o.DRAGON}isNumberedSuit(){return this.suit>=o.CRACK&&this.suit<=o.DOT}isInvalid(){return this.suit===o.INVALID}static fromPhaserTile(e){return new D(e.suit,e.number,e.index)}toJSON(){return{suit:this.suit,number:this.number,index:this.index}}static fromJSON(e){return new D(e.suit,e.number,e.index)}}class G{constructor(){this.tiles=[],this.exposures=[]}get exposedTileSetArray(){return this.exposures}getLength(){const e=this.exposures.reduce((t,n)=>t+n.tiles.length,0);return this.tiles.length+e}getHiddenCount(){return this.tiles.length}getHiddenTileArray(){return this.tiles}getTileArray(){return this.tiles}getAllTilesIncludingExposures(){const e=[...this.tiles];return this.exposures.forEach(t=>{e.push(...t.tiles)}),e}addTile(e){this.tiles.push(e)}removeTile(e){const t=this.tiles.findIndex(n=>n.isSameTile(e));return t!==-1?(this.tiles.splice(t,1),!0):!1}addExposure(e){this.exposures.push(e)}hasTile(e){return this.tiles.some(t=>t.equals(e))}isAllHidden(){return this.exposures.length===0}countTile(e,t){return this.tiles.filter(n=>n.suit===e&&n.number===t).length}sortBySuit(){this.tiles.sort((e,t)=>e.suit!==t.suit?e.suit-t.suit:e.number-t.number)}sortByRank(){this.tiles.sort((e,t)=>e.number!==t.number?e.number-t.number:e.suit-t.suit)}clear(){this.tiles=[],this.exposures=[]}clone(){const e=new G;return e.tiles=this.tiles.map(t=>t.clone()),e.exposures=this.exposures.map(t=>t.clone()),e}static fromPhaserHand(e){const t=new G,n=e.getHiddenTileArray();return t.tiles=n.map(r=>D.fromPhaserTile(r)),e.exposedTileSetArray.forEach(r=>{const s=new $;s.type=oe(r.tileArray.length),s.tiles=r.tileArray.map(i=>D.fromPhaserTile(i)),t.exposures.push(s)}),t}toJSON(){return{tiles:this.tiles.map(e=>e.toJSON()),exposures:this.exposures.map(e=>e.toJSON())}}static fromJSON(e){const t=new G;return t.tiles=e.tiles.map(n=>D.fromJSON(n)),t.exposures=e.exposures.map(n=>$.fromJSON(n)),t}}class ${constructor(e={}){this.type=e.type||"",this.tiles=e.tiles||[]}clone(){const e=new $;return e.type=this.type,e.tiles=this.tiles.map(t=>t.clone()),e}toJSON(){return{type:this.type,tiles:this.tiles.map(e=>e.toJSON())}}get tileArray(){return this.tiles}getTileArray(){return this.tiles}getLength(){return this.tiles.length}static fromJSON(e){const t=new $;return t.type=e.type,t.tiles=e.tiles.map(n=>D.fromJSON(n)),t}}function oe(l){return l===3?"PUNG":l===4?"KONG":l===5?"QUINT":"UNKNOWN"}class U{constructor(e,t=""){this.position=e,this.name=t||this.getDefaultName(),this.hand=new G,this.isHuman=e===T.BOTTOM,this.isCurrentTurn=!1,this.wind=""}getDefaultName(){return["You","Opponent 1","Opponent 2","Opponent 3"][this.position]||`Player ${this.position+1}`}clone(){const e=new U(this.position,this.name);return e.hand=this.hand.clone(),e.isHuman=this.isHuman,e.isCurrentTurn=this.isCurrentTurn,e.wind=this.wind,e}static fromPhaserPlayer(e){const t=new U(e.playerInfo.playerNum,e.playerInfo.name);return t.hand=G.fromPhaserHand(e.hand),t.wind=e.playerInfo.wind,t}toJSON(){return{position:this.position,name:this.name,hand:this.hand.toJSON(),isHuman:this.isHuman,isCurrentTurn:this.isCurrentTurn,wind:this.wind}}static fromJSON(e){const t=new U(e.position,e.name);return t.hand=G.fromJSON(e.hand),t.isHuman=e.isHuman,t.isCurrentTurn=e.isCurrentTurn,t.wind=e.wind,t}}function ie(l,e){return{type:"STATE_CHANGED",oldState:l,newState:e,timestamp:Date.now()}}function ae(l){return{type:"GAME_STARTED",players:l,timestamp:Date.now()}}function le(l=[]){return{type:"TILES_DEALT",sequence:l,timestamp:Date.now()}}function ce(l,e,t={}){return{type:"TILE_DRAWN",player:l,tile:e,animation:{type:t.type||"deal-slide",fromPosition:t.fromPosition||{x:640,y:360},toPosition:t.toPosition||{x:450,y:575},duration:t.duration||400,easing:t.easing||"Quad.easeOut",...t},timestamp:Date.now()}}function ue(l,e,t={}){return{type:"TILE_DISCARDED",player:l,tile:e,animation:{type:t.type||"discard-slide",fromPosition:t.fromPosition||{x:450,y:575},toPosition:t.toPosition||{x:350,y:420},duration:t.duration||300,easing:t.easing||"Power2.easeInOut",glow:t.glow||{color:1981066,alpha:.9},...t},timestamp:Date.now()}}function he(l,e,t,n){return{type:"BLANK_EXCHANGED",player:l,blankTile:e,retrievedTile:t,discardIndex:n,timestamp:Date.now()}}function v(l,e){return{type:"HAND_UPDATED",player:l,hand:e,timestamp:Date.now()}}function q(l,e){return{type:"TURN_CHANGED",currentPlayer:l,previousPlayer:e,timestamp:Date.now()}}function de(l,e,t){return{type:"CHARLESTON_PHASE",phase:l,passCount:e,direction:t,timestamp:Date.now()}}function me(l,e,t,n,r={}){const i={right:1,across:2,left:3}[t]||1;return{type:"CHARLESTON_PASS",fromPlayer:l,toPlayer:e,direction:t,tiles:n,animation:{type:r.type||"pass-tiles",direction:r.direction||t,duration:r.duration||500,easing:r.easing||"Sine.easeInOut",offset:i,...r},timestamp:Date.now()}}function fe(l,e){return{type:"COURTESY_VOTE",player:l,vote:e,timestamp:Date.now()}}function ge(l,e,t,n={}){return{type:"COURTESY_PASS",fromPlayer:l,toPlayer:e,tiles:t,animation:{type:n.type||"courtesy-exchange",duration:n.duration||600,easing:n.easing||"Sine.easeInOut",glow:n.glow||{color:2003199,alpha:.7},...n},timestamp:Date.now()}}function ne(l,e,t,n={}){return{type:"TILES_RECEIVED",player:l,fromPlayer:t,tiles:e,animation:{type:n.type||"receive-tiles",duration:n.duration||400,easing:n.easing||"Power2.easeOut",glow:n.glow||{color:2003199,alpha:.7},...n},timestamp:Date.now()}}function pe(l,e,t){return{type:"DISCARD_CLAIMED",claimingPlayer:l,tile:e,claimType:t,timestamp:Date.now()}}function Te(l,e,t,n={}){return{type:"TILES_EXPOSED",player:l,exposureType:e,tiles:t,animation:{type:n.type||"expose-tiles",duration:n.duration||300,easing:n.easing||"Power2.easeOut",effect:n.effect||"highlight",...n},timestamp:Date.now()}}function Ee(l,e,t){return{type:"GAME_ENDED",reason:l,winner:e,mahjong:t,timestamp:Date.now()}}function w(l,e="info"){return{type:"MESSAGE",text:l,messageType:e,timestamp:Date.now()}}class Ce extends Error{constructor(e,t="UNKNOWN",n=!1){super(e),this.name="GameError",this.code=t,this.recoverable=n}}class j extends Ce{constructor(e){super(e,"STATE_ERROR",!1),this.name="StateError"}}const ye=[[T.BOTTOM,4],[T.RIGHT,4],[T.TOP,4],[T.LEFT,4],[T.BOTTOM,4],[T.RIGHT,4],[T.TOP,4],[T.LEFT,4],[T.BOTTOM,4],[T.RIGHT,4],[T.TOP,4],[T.LEFT,4],[T.BOTTOM,1],[T.RIGHT,1],[T.TOP,1],[T.LEFT,1],[T.BOTTOM,1]];class Ae{constructor(e){this.gameController=e}buildInitialDealSequence(){const e=this.generateTrainingTilesIfEnabled();return this.distributeTilesToPlayers(e)}generateTrainingTilesIfEnabled(){const{settings:e,cardValidator:t}=this.gameController;if(!e.trainingMode||!e.trainingHand)return null;const r=t.generateHand(e.trainingHand,e.trainingTileCount).getTileArray(),s=this.matchTrainingTilesToWall(r);return this.logTrainingModeInfo(s),this.emitTrainingModeMessage(),s}matchTrainingTilesToWall(e){const t=[],{wallTiles:n}=this.gameController;for(const r of e){const s=n.findIndex(i=>i.suit===r.suit&&i.number===r.number);if(s!==-1){const i=n.splice(s,1)[0];t.push(i)}else ee(`Could not find matching tile for ${r.suit}-${r.number}`),t.push(r)}return t}logTrainingModeInfo(e){const{debug:t,settings:n}=this.gameController;t&&(I("Training Mode Settings:",{trainingMode:n.trainingMode,trainingHand:n.trainingHand,trainingTileCount:n.trainingTileCount}),I("Generated hand tiles:",e.map(r=>`${r.suit}-${r.number} (index: ${r.index})`)))}emitTrainingModeMessage(){const{settings:e}=this.gameController;this.gameController.emit("MESSAGE",{text:`Training Mode: Dealing ${e.trainingTileCount} tiles for "${e.trainingHand}"`,type:"info"})}distributeTilesToPlayers(e){const t=[];let n=0;const{players:r}=this.gameController;for(const[s,i]of ye){const a=[],c=r[s];for(let u=0;u<i;u++){const d=this.getNextTileForPlayer(s,e,n);s===T.BOTTOM&&e&&n<e.length&&n++,c.hand.addTile(d),a.push(d.toJSON())}c.hand.sortBySuit(),t.push({player:s,tiles:a})}return t}getNextTileForPlayer(e,t,n){return e===T.BOTTOM&&t&&n<t.length?t[n]:this.gameController.gameLoopManager.drawTileFromWall()}emitDealingStartEvent(e){const t=le(e);this.gameController.emit("TILES_DEALT",t)}waitForDealingComplete(){return new Promise(e=>{let t=null,n=!1;const r=()=>{n||(n=!0,t!==null&&clearTimeout(t),this.emitHandUpdatedForAllPlayers(),e())};this.gameController.once("DEALING_COMPLETE",r),t=setTimeout(()=>{this.gameController.off("DEALING_COMPLETE",r),r()},3e4)})}emitHandUpdatedForAllPlayers(){const{players:e}=this.gameController;e.forEach((t,n)=>{const r=v(n,t.hand.toJSON());this.gameController.emit("HAND_UPDATED",r)})}}const Q={1:["right","across","left"],2:["left","across","right"]},Se={right:1,across:2,left:3};class Oe{constructor(e){this.gameController=e}async executeCharlestonPasses(e){const t=Q[e]||Q[1];for(let n=0;n<t.length;n++){const r=t[n],s=Se[r];typeof s=="number"&&await this.executeSingleCharlestonPass(e,n+1,r,s)}}async executeSingleCharlestonPass(e,t,n,r){this.gameController.setState(e===1?C.CHARLESTON1:C.CHARLESTON2),this.emitCharlestonPhaseEvent(e,t,n);const s=await this.collectCharlestonTiles(n,r);this.exchangeCharlestonTiles(s,r,n),await this.gameController.sleep(500)}emitCharlestonPhaseEvent(e,t,n){const r=de(e,t,n);this.gameController.emit("CHARLESTON_PHASE",r)}async collectCharlestonTiles(e,t){const n=[],{players:r}=this.gameController;for(let s=0;s<4;s++){const i=r[s],a=await this.selectTilesToPass(i,s,e);this.removeTilesFromPlayerHand(i,s,a),n[s]=a,this.emitHandUpdatedForPlayer(s),this.emitCharlestonPassEvent(s,t,e,a)}return n}async selectTilesToPass(e,t,n){return e.isHuman?this.gameController.promptUI("CHARLESTON_PASS",{direction:n,requiredCount:3}):this.gameController.aiEngine.charlestonPass(e.hand)}removeTilesFromPlayerHand(e,t,n){n.forEach(r=>e.hand.removeTile(r)),I(`[CharlestonManager] Player ${t} removed ${n.length} tiles, hand now has ${e.hand.tiles.length} tiles`)}emitHandUpdatedForPlayer(e){const t=v(e,this.gameController.players[e].hand.toJSON());this.gameController.emit("HAND_UPDATED",t)}emitCharlestonPassEvent(e,t,n,r){const s=(e+t)%4,i=me(e,s,n,r.map(a=>({suit:a.suit,number:a.number,index:a.index})),{type:"charleston-pass",direction:n,duration:600,easing:"ease-in-out"});this.gameController.emit("CHARLESTON_PASS",i)}exchangeCharlestonTiles(e,t,n){for(let r=0;r<4;r++){const s=r,i=(r+t)%4;this.addTilesToReceivingPlayer(i,s,e[s]),this.emitTilesReceivedEvent(i,s,n,e[s]),this.emitHandUpdatedForPlayer(i)}}addTilesToReceivingPlayer(e,t,n){n.forEach(r=>{this.gameController.players[e].hand.addTile(r)}),I(`[CharlestonManager] Player ${e} received ${n.length} tiles, hand now has ${this.gameController.players[e].hand.tiles.length} tiles`)}emitTilesReceivedEvent(e,t,n,r){const s=r.map(a=>({suit:a.suit,number:a.number,index:a.index})),i=ne(e,s,t,{type:"charleston-receive",direction:n,duration:600,glow:{persist:!0,color:2003199}});this.gameController.emit("TILES_RECEIVED",i)}async queryCharlestonContinue(){const e=await this.getHumanVote(),t=this.getAIVotes(),n=this.calculateVoteResult(e,t);return this.emitVoteResultMessage(n,e,t),n}async getHumanVote(){return this.gameController.promptUI("CHARLESTON_CONTINUE",{question:"Continue Charleston to phase 2?",options:["Yes","No"]})}getAIVotes(){return this.gameController.players.filter(e=>!e.isHuman).map(e=>this.gameController.aiEngine.charlestonContinueVote(e.hand))}calculateVoteResult(e,t){return!0}emitVoteResultMessage(e,t,n){const r=[t==="Yes",...n],s=r.filter(u=>u).length,i=r.filter(u=>!u).length,a=e?"All players voted YES - continuing to Charleston phase 2":`Vote: ${s} Yes, ${i} No - skipping Charleston phase 2`,c=w(a,"info");this.gameController.emit("MESSAGE",c)}}class Ie{constructor(e){this.gameController=e}async executeCourtesyPhase(){this.gameController.setState(C.COURTESY_QUERY);const e=await this.collectCourtesyVotes();e.filter(n=>n.vote>0).length>=2&&await this.executeCourtesyPass(e),this.gameController.setState(C.COURTESY_COMPLETE)}async collectCourtesyVotes(){const e=[];for(const t of this.gameController.players){let n;if(t.isHuman){const s=await this.gameController.promptUI("COURTESY_VOTE",{question:"Courtesy Pass: How many tiles to exchange with opposite player?",options:["0","1","2","3"]});n=parseInt(s,10),(isNaN(n)||n<0||n>3)&&(n=0)}else n=await this.gameController.aiEngine.courtesyVote(t.hand);e.push({player:t.position,vote:n});const r=fe(t.position,n);this.gameController.emit("COURTESY_VOTE",r)}return e}async executeCourtesyPass(e){this.gameController.setState(C.COURTESY);const t=Math.min(e[0].vote,e[2].vote),n=Math.min(e[1].vote,e[3].vote);if(t===0&&n===0){const s=w("Courtesy pass skipped (opposite players must both agree).","info");this.gameController.emit("MESSAGE",s);return}this.emitCourtesyVoteMessage(e,t);const r=await this.collectCourtesyTiles(e,t,n);this.exchangeCourtesyTiles(r),this.finalizeCourtesyPass(),await this.gameController.sleep(1e3)}emitCourtesyVoteMessage(e,t){const n=[];for(let s=0;s<4;s++){const i=this.gameController.players[s].name,a=e[s].vote;n.push(`${i} voted ${a}`)}const r=w(`Courtesy pass: ${n.join(", ")}. Passing ${t>0?t+" tile(s) with opposite player":"no tiles"}.`,"info");this.gameController.emit("MESSAGE",r)}async collectCourtesyTiles(e,t,n){const r=[];for(let s=0;s<4;s++){const i=this.gameController.players[s],a=s===0||s===2?t:n;if(a===0){r[s]=[];continue}let c;if(i.isHuman){const h=this.gameController.players[(s+2)%4],g=e[(s+2)%4].vote,f=e[s].vote;c=await this.gameController.promptUI("SELECT_TILES",{question:`${h.name} voted ${g}, you voted ${f}. Select exactly ${a} tile(s) to pass.`,minTiles:a,maxTiles:a})}else c=await this.gameController.aiEngine.courtesyPass(i.hand,a);r[s]=c,c.forEach(h=>i.hand.removeTile(h));const u=(s+2)%4,d=ge(s,u,c.map(h=>({suit:h.suit,number:h.number,index:h.index})),{duration:500});this.gameController.emit("COURTESY_PASS",d)}return r}exchangeCourtesyTiles(e){for(let t=0;t<4;t++){const n=(t+2)%4,r=e[n];if(r.forEach(s=>this.gameController.players[t].hand.addTile(s)),r.length>0){const s=ne(t,r.map(i=>({suit:i.suit,number:i.number,index:i.index})),n,{duration:500});this.gameController.emit("TILES_RECEIVED",s)}}}finalizeCourtesyPass(){this.gameController.players.forEach(t=>t.hand.sortBySuit()),this.gameController.players.forEach((t,n)=>{const r=v(n,t.hand.toJSON());this.gameController.emit("HAND_UPDATED",r)});const e=w("Courtesy pass complete.","info");this.gameController.emit("MESSAGE",e)}}class De{constructor(e){this.gameController=e}async execute(){for(this.gameController.setState(C.LOOP_PICK_FROM_WALL);this.gameController.state!==C.END&&this.gameController.wallTiles.length>0;){if(this.shouldDrawTile()&&(await this.pickFromWall(),this.checkMahjong())){this.gameController.endGame("mahjong");return}await this.chooseDiscard();const e=await this.queryClaimDiscard();if(e.claimed){if(this.handleDiscardClaim(e),this.gameController.gameResult.mahjong)return;await this.chooseDiscard()}else this.advanceTurn()}this.gameController.wallTiles.length===0&&!this.gameController.gameResult.mahjong&&this.gameController.endGame("wall_game")}drawTileFromWall(){if(this.gameController.wallTiles.length===0)throw new j("Attempted to draw from an empty wall");return this.gameController.wallTiles.pop()}shouldDrawTile(){const e=this.gameController.players[this.gameController.currentPlayer];return!e||!e.hand?!1:e.hand.getLength()===13}async pickFromWall(){if(this.gameController.setState(C.LOOP_PICK_FROM_WALL),this.gameController.wallTiles.length===0)return;const e=this.gameController.players[this.gameController.currentPlayer],t=this.drawTileFromWall();e.hand.addTile(t),e.hand.sortBySuit();const n=ce(this.gameController.currentPlayer,t.toJSON(),{type:"wall-draw",duration:300,easing:"Quad.easeOut"});this.gameController.emit("TILE_DRAWN",n);const r=v(this.gameController.currentPlayer,e.hand.toJSON());this.gameController.emit("HAND_UPDATED",r),await this.gameController.sleep(W.TILE_DRAWN_DELAY)}async chooseDiscard(){this.gameController.setState(C.LOOP_CHOOSE_DISCARD);const e=this.gameController.players[this.gameController.currentPlayer];let t;if(e.isHuman?t=await this.gameController.promptUI("CHOOSE_DISCARD",{hand:e.hand.toJSON()}):t=await this.gameController.aiEngine.chooseDiscard(e.hand),!t)if(e.hand.tiles.length>0)ee(`chooseDiscard: No tile returned for player ${this.gameController.currentPlayer}, falling back to first tile.`),t=e.hand.tiles[0];else throw new j(`chooseDiscard: Player ${this.gameController.currentPlayer} hand is empty, cannot discard.`);const n=e.hand.tiles.findIndex(u=>u.isSameTile(t));if(!e.hand.removeTile(t))throw new j(`chooseDiscard: Failed to remove tile ${t.toString()} from player ${this.gameController.currentPlayer} hand.`);this.gameController.discards.push(t);const s={suit:t.suit,number:t.number,index:t.index},i={type:"discard-arc",duration:this.gameController.currentPlayer===0?W.DISCARD_ANIMATION_HUMAN:W.DISCARD_ANIMATION_AI,easing:"ease-out",rotation:this.gameController.currentPlayer===0?360:180};n>=0&&(i.tileIndex=n);const a=ue(this.gameController.currentPlayer,s,i);this.gameController.emit("TILE_DISCARDED",a);const c=v(this.gameController.currentPlayer,e.hand.toJSON());this.gameController.emit("HAND_UPDATED",c),await this.gameController.sleep(W.DISCARD_COMPLETE_DELAY)}async queryClaimDiscard(){this.gameController.setState(C.LOOP_QUERY_CLAIM_DISCARD);const e=this.gameController.discards[this.gameController.discards.length-1];if(!e||e.isJoker()||e.isBlank())return{claimed:!1};for(let t=1;t<=3;t++){const n=(this.gameController.currentPlayer+t)%4,r=this.gameController.players[n],s=await this.getPlayerClaimDecision(r,n,e);if(s!=="Pass")return{claimed:!0,player:n,claimType:s}}return{claimed:!1}}getPlayerClaimDecision(e,t,n){return e.isHuman?this.getHumanClaimDecision(e,n):this.getAIClaimDecision(e,t,n)}getHumanClaimDecision(e,t){const n=this.canPlayerFormExposure(e,t),r=this.canPlayerMahjongWithTile(e,t);return!n&&!r?Promise.resolve("Pass"):this.gameController.promptUI("CLAIM_DISCARD",{tile:t.toJSON(),options:["Mahjong","Pung","Kong","Pass"]})}async getAIClaimDecision(e,t,n){const r=await this.gameController.aiEngine.claimDiscard(n,t,e.hand);return this.convertAIDecisionToClaimType(r)}convertAIDecisionToClaimType(e){if(e.playerOption===J.MAHJONG)return"Mahjong";if(e.playerOption===J.EXPOSE_TILES){const t=e.tileArray.length;if(t===3)return"Pung";if(t===4)return"Kong";if(t===5)return"Quint"}return"Pass"}canPlayerFormExposure(e,t){if(!e||!e.hand)return!1;const n=e.hand.tiles||[];if(n.length===0)return!1;const r=n.filter(i=>i.suit===t.suit&&i.number===t.number).length,s=n.filter(i=>i.isJoker()).length;return r+s>=2}canPlayerMahjongWithTile(e,t){if(!this.gameController.cardValidator||!e||!e.hand)return!1;const n=e.hand.clone(),r=t.clone?t.clone():new D(t.suit,t.number,t.index);n.addTile(r);const s=n.getAllTilesIncludingExposures?n.getAllTilesIncludingExposures():n.tiles,i=n.exposures.length===0;try{const a=this.gameController.cardValidator.validateHand(s,i);return!!(a&&a.valid)}catch{return!1}}handleDiscardClaim(e){const{player:t,claimType:n}=e,r=this.gameController.discards.pop(),s=this.gameController.players[t];if(n==="Mahjong"){this.handleMahjongClaim(t,s,r);return}this.handleExposureClaim(t,s,r,n)}handleMahjongClaim(e,t,n){t.hand.addTile(n);const r=t.hand.getAllTilesIncludingExposures?t.hand.getAllTilesIncludingExposures():t.hand.tiles,s=t.hand.exposures.length===0;try{const i=this.gameController.cardValidator.validateHand(r,s);if(i&&i.valid){this.gameController.gameResult.mahjong=!0,this.gameController.gameResult.winner=e,this.gameController.endGame("mahjong");return}else this.rejectMahjongClaim(e,t,n)}catch{this.rejectMahjongClaim(e,t,n,!0)}}rejectMahjongClaim(e,t,n,r=!1){t.hand.removeTile(n),this.gameController.discards.push(n);const s=r?"Invalid Mahjong claim - validation error":"Invalid Mahjong claim - hand does not match any winning pattern";this.gameController.emit("MESSAGE",w(s,"error"))}handleExposureClaim(e,t,n,r){t.hand.addTile(n);const s={suit:n.suit,number:n.number,index:n.index},i=pe(e,s,r);this.gameController.emit("DISCARD_CLAIMED",i),this.gameController.setState(C.LOOP_EXPOSE_TILES),this.exposeTiles(e,r,n),this.gameController.currentPlayer=e;const a=q(this.gameController.currentPlayer,(this.gameController.currentPlayer+3)%4);this.gameController.emit("TURN_CHANGED",a)}exposeTiles(e,t,n){const r=this.gameController.players[e],s=r.hand.tiles.filter(f=>f.equals(n)&&!f.isSameTile(n)),i=r.hand.tiles.filter(f=>f.isJoker()),a=t==="Pung"?2:t==="Kong"?3:4;if(s.length+i.length<a){console.warn("Exposure attempted without enough tiles",{playerIndex:e,exposureType:t,claimedTile:n});return}const u=s.slice(0,a),d=a-u.length;if(d>0){const f=i.slice(0,d);u.push(...f)}u.forEach(f=>{r.hand.removeTile(f)}),u.push(n),r.hand.addExposure(u,t);const h=Te(e,u.map(f=>f.toJSON()),t);this.gameController.emit("TILES_EXPOSED",h);const g=v(e,r.hand.toJSON());this.gameController.emit("HAND_UPDATED",g)}exchangeBlankWithDiscard(e,t){if(!this.gameController.settings.useBlankTiles)throw new Error("Blank exchange is disabled (house rule off)");if(this.gameController.state!==C.LOOP_CHOOSE_DISCARD)throw new Error("Blank exchange only allowed during discard selection");const n=this.gameController.players[0];if(!n||!n.isHuman)throw new Error("Blank exchange only available to human player");const r=Y(e),s=Y(t);if(!r.isBlank())throw new Error("Selected tile is not a blank");if(!n.hand.removeTile(r))throw new Error("Blank tile not found in hand");const a=this.gameController.discards.findIndex(f=>f.isSameTile(s));if(a===-1)throw new Error("Selected discard tile no longer available");if(this.gameController.discards[a].isJoker())throw new Error("Cannot exchange blank for a joker");const[u]=this.gameController.discards.splice(a,1);this.gameController.discards.push(r),n.hand.addTile(u),n.hand.sortBySuit();const d=he(0,r.toJSON(),u.toJSON(),this.gameController.discards.length-1);this.gameController.emit("BLANK_EXCHANGED",d);const h=v(0,n.hand.toJSON());this.gameController.emit("HAND_UPDATED",h);const g=w(`Blank exchanged for ${u.getText()} from discards.`,"info");return this.gameController.emit("MESSAGE",g),!0}checkMahjong(){const e=this.gameController.players[this.gameController.currentPlayer];if(e.hand.getLength()!==14)return!1;if(this.gameController.cardValidator){const t=e.hand.getAllTilesIncludingExposures?e.hand.getAllTilesIncludingExposures():e.hand.tiles,n=e.hand.exposures.length===0,r=this.gameController.cardValidator.validateHand(t,n);if(r&&r.valid)return this.gameController.gameResult.mahjong=!0,this.gameController.gameResult.winner=this.gameController.currentPlayer,!0}return!1}advanceTurn(){const e=this.gameController.currentPlayer;this.gameController.currentPlayer=(this.gameController.currentPlayer+1)%4;const t=q(this.gameController.currentPlayer,e);this.gameController.emit("TURN_CHANGED",t)}}class Re{constructor(e){this.gameController=e}async execute(){const e=this.gameController.players[T.BOTTOM];if(!e||!e.hand)return!1;if(!this.isValidStateForExchange())return this.gameController.emit("MESSAGE",w("Cannot exchange jokers during this phase","warning")),!1;const t=this.findExposedJokers();if(t.length===0)return this.gameController.emit("MESSAGE",w("No exposed jokers available","info")),!1;const n=this.filterMatchingExchanges(t,e);if(n.length===0)return this.gameController.emit("MESSAGE",w("No matching tiles to exchange","info")),!1;const r=await this.selectExchange(n);return this.performExchange(r,e)}isValidStateForExchange(){return![C.INIT,C.DEAL,C.CHARLESTON1,C.CHARLESTON2,C.CHARLESTON_QUERY,C.COURTESY_QUERY,C.COURTESY].includes(this.gameController.state)}findExposedJokers(){const e=[];for(let t=0;t<4;t++)this.gameController.players[t].hand.exposures.forEach((r,s)=>{r.tiles.forEach((i,a)=>{i.suit===o.JOKER&&e.push({playerIndex:t,exposureIndex:s,tileIndex:a,jokerTile:i,requiredTiles:this.getRequiredTilesForJoker(r)})})});return e}filterMatchingExchanges(e,t){return e.filter(n=>n.requiredTiles.some(r=>t.hand.tiles.some(s=>s.suit===r.suit&&s.number===r.number)))}selectExchange(e){if(e.length>1){const t=e.map(n=>{const r=n.requiredTiles[0],s=this.gameController.players[n.playerIndex];return{label:`Trade your ${this.formatTileForDisplay(r)} for Joker from ${s.name}`,value:n}});return this.gameController.promptUI("JOKER_EXCHANGE_CHOICE",{question:"Multiple joker exchanges available. Choose one:",options:t})}else return e[0]}performExchange(e,t){const n=e.requiredTiles[0],r=t.hand.tiles.findIndex(d=>d.suit===n.suit&&d.number===n.number);if(r===-1)return!1;const s=t.hand.tiles[r],i=e.jokerTile;t.hand.removeTile(s),t.hand.addTile(i);const a=this.gameController.players[e.playerIndex];a.hand.exposures[e.exposureIndex].tiles[e.tileIndex]=s,this.gameController.emit("JOKER_SWAPPED",{player:e.playerIndex,exposureIndex:e.exposureIndex,jokerIndex:i.index,replacementTile:s,recipient:T.BOTTOM});const c=v(T.BOTTOM,t.hand.toJSON());this.gameController.emit("HAND_UPDATED",c);const u=v(e.playerIndex,a.hand.toJSON());return this.gameController.emit("HAND_UPDATED",u),this.gameController.emit("MESSAGE",w(`Exchanged ${s.getText()} for joker`,"info")),!0}formatTileForDisplay(e){if(!e)return"";const{suit:t,number:n}=e;return t===o.CRACK?`${n} Crack`:t===o.BAM?`${n} Bam`:t===o.DOT?`${n} Dot`:t===o.WIND?{[P.NORTH]:"North Wind",[P.SOUTH]:"South Wind",[P.EAST]:"East Wind",[P.WEST]:"West Wind"}[n]||"Wind":t===o.DRAGON?{[O.RED]:"Red Dragon",[O.GREEN]:"Green Dragon",[O.WHITE]:"White Dragon"}[n]||"Dragon":t===o.FLOWER?`Flower ${typeof n=="number"?n+1:1}`:t===o.JOKER?"Joker":t===o.BLANK?"Blank":`${n??""}`}getRequiredTilesForJoker(e){const t=e.tiles.filter(n=>n.suit!==o.JOKER);return t.length>0?[t[0]]:[]}}class qe extends se{constructor(){super(),this.state=C.INIT,this.players=[],this.wallTiles=[],this.discards=[],this.currentPlayer=0,this.settings={year:2025,difficulty:"medium",useBlankTiles:!1,skipCharleston:!1,trainingMode:!1,trainingHand:"",trainingTileCount:13},this.debug=!1,this.charlestonState={phase:0,passCount:0,continueToPhase2:!1,courtesyVotes:[]},this.gameResult={mahjong:!1,winner:-1,winningHand:null},this.aiEngine=null,this.cardValidator=null,this.wallGenerator=null,this.dealingManager=new Ae(this),this.charlestonManager=new Oe(this),this.courtesyManager=new Ie(this),this.gameLoopManager=new De(this),this.jokerExchangeManager=new Re(this)}init(e={}){this.aiEngine=e.aiEngine,this.cardValidator=e.cardValidator,this.wallGenerator=e.wallGenerator||null,e.settings&&(this.settings={...this.settings,...e.settings}),this.players=[new U(T.BOTTOM,"You"),new U(T.RIGHT,"Bot Bob"),new U(T.TOP,"Sally Bot"),new U(T.LEFT,"Stephen Bot")],this.assignPlayerWinds();const t=w(`Game initialized with ${this.settings.year} card`,"info");this.emit("MESSAGE",t)}assignPlayerWinds(){const e={[T.BOTTOM]:P.EAST,[T.RIGHT]:P.NORTH,[T.TOP]:P.WEST,[T.LEFT]:P.SOUTH};Object.entries(e).forEach(([t,n])=>{const r=this.players[t];r&&(r.wind=n)})}async startGame(){if(this.state!==C.INIT&&this.state!==C.END)return;this.setState(C.START),this.gameResult={mahjong:!1,winner:-1,winningHand:null},this.charlestonState={phase:0,passCount:0,continueToPhase2:!1,courtesyVotes:[]},this.discards=[],this.currentPlayer=T.BOTTOM,this.players.forEach(t=>t.hand.clear()),this.createWall();const e=ae(this.players.map(t=>t.toJSON()));this.emit("GAME_STARTED",e),await this.dealTiles(),this.settings.skipCharleston?await this.gameLoop():await this.charlestonPhase()}createWall(){const e=this.wallGenerator?this.wallGenerator():Ne(this.settings.useBlankTiles);if(!Array.isArray(e)||e.length===0)throw new j("Failed to generate wall tiles. Wall generator returned empty set.");const t=e.map((n,r)=>Y(n,r));this.wallTiles=be(t),this.emit("WALL_CREATED",{tileCount:this.wallTiles.length}),this.emit("MESSAGE",{text:`Wall created with ${this.wallTiles.length} tiles`,type:"info"})}async dealTiles(){this.setState(C.DEAL);const e=this.dealingManager.buildInitialDealSequence();this.dealingManager.emitDealingStartEvent(e),await this.dealingManager.waitForDealingComplete()}async charlestonPhase(){if(this.settings.skipCharleston){await this.gameLoop();return}this.charlestonState.phase=1,await this.charlestonManager.executeCharlestonPasses(1),this.setState(C.CHARLESTON_QUERY),await this.charlestonManager.queryCharlestonContinue()&&(this.charlestonState.phase=2,await this.charlestonManager.executeCharlestonPasses(2)),await this.courtesyPhase(),await this.gameLoop()}async courtesyPhase(){await this.courtesyManager.executeCourtesyPhase()}async gameLoop(){await this.gameLoopManager.execute()}exchangeBlankWithDiscard(e,t){return this.gameLoopManager.exchangeBlankWithDiscard(e,t)}endGame(e){this.setState(C.END);const t=Ee(e,this.gameResult.winner,this.gameResult.mahjong);if(this.emit("GAME_ENDED",t),e==="mahjong"){const n=this.players[this.gameResult.winner],r=w(`${n.name} wins with Mahjong!`,"info");this.emit("MESSAGE",r)}else if(e==="wall_game"){const n=w("Wall game - no winner","info");this.emit("MESSAGE",n)}}setState(e){const t=this.state;this.state=e;const n=ie(t,e);this.emit("STATE_CHANGED",n)}onSortHandRequest(e="suit"){const t=this.players[T.BOTTOM];if(!t||!t.hand)return;e==="rank"?t.hand.sortByRank():t.hand.sortBySuit();const n=v(T.BOTTOM,t.hand.toJSON());this.emit("HAND_UPDATED",n)}async onExchangeJoker(){return this.jokerExchangeManager.execute()}promptUI(e,t){return new Promise(n=>{this.emit("UI_PROMPT",{promptType:e,options:t,callback:r=>n(r)})})}sleep(e){return new Promise(t=>setTimeout(t,e))}getGameState(){return{state:this.state,currentPlayer:this.currentPlayer,players:this.players.map(e=>e.toJSON()),wallCount:this.wallTiles.length,discardCount:this.discards.length,gameResult:this.gameResult}}}function Y(l,e=-1){if(l instanceof D)return l.clone();if(l&&typeof l=="object"&&typeof l.suit=="number"){const t=typeof l.index=="number"?l.index:e;return new D(l.suit,l.number??0,t)}throw new Error("Wall generator produced invalid tile data")}function Ne(l=!1){const e=[];let t=0;for(const n of te){if(n.suit===o.BLANK&&!l)continue;const r=Array.isArray(n.prefix)?n.prefix:[n.prefix];for(const s of r)for(let i=1;i<=n.maxNum;i++){let a=i;n.maxNum===1&&(n.suit===o.FLOWER?a=0:a=r.indexOf(s));for(let c=0;c<n.count;c++)e.push(new D(n.suit,a,t++))}}return e}function be(l){const e=l.slice();for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}class Qe{constructor(e){this.gameController=e,this.subscriptions=[]}registerEventHandlers(e={}){Object.entries(e).forEach(([t,n])=>{const r=this.gameController.on(t,n);typeof r=="function"&&this.subscriptions.push(r)})}destroy(){Array.isArray(this.subscriptions)&&(this.subscriptions.forEach(e=>{try{typeof e=="function"&&e()}catch{}}),this.subscriptions=[])}}const V={[o.VSUIT1]:"green",[o.VSUIT2]:"red",[o.VSUIT3]:"blue",[o.FLOWER]:"black",[o.WIND]:"black",[o.DRAGON]:"blue",[o.JOKER]:"gray",[o.CRACK]:"red",[o.BAM]:"green",[o.DOT]:"blue"};function F(l,e=!1,t=null,n=null){if(l.suit===o.JOKER)return{char:"J",color:V[o.JOKER],tile:l};if(l.suit===o.FLOWER)return{char:"F",color:V[o.FLOWER],tile:l};if(l.suit===o.WIND)return{char:{[P.NORTH]:"N",[P.EAST]:"E",[P.SOUTH]:"S",[P.WEST]:"W"}[l.number]||"?",color:V[o.WIND],tile:l};if(l.suit===o.DRAGON||l.suit>=o.VSUIT1_DRAGON&&l.suit<=o.VSUIT3_DRAGON){if(l.suit===o.DRAGON&&l.number===O.WHITE)return{char:"0",color:"blue",tile:l};let r="blue";if(l.suit===o.DRAGON)if(l._originalVsuit!==void 0&&n&&n.has(l._originalVsuit)){const s=n.get(l._originalVsuit);r={[O.RED]:"red",[O.GREEN]:"green",[O.WHITE]:"blue"}[s]||"blue"}else r={[O.RED]:"red",[O.GREEN]:"green",[O.WHITE]:"blue"}[l.number]||"blue";else if(l.suit>=o.VSUIT1_DRAGON&&l.suit<=o.VSUIT3_DRAGON)if(n&&n.has(l.suit)){const s=n.get(l.suit);r={[O.RED]:"red",[O.GREEN]:"green",[O.WHITE]:"blue"}[s]||"blue"}else if(t){const s=l.suit-o.VSUIT1_DRAGON,i=t[s];i>=0&&i<=2?r={[O.RED]:"red",[O.GREEN]:"green",[O.WHITE]:"blue"}[i]||"blue":r=["red","green","blue"][s]||"blue"}else{const s=l.suit-o.VSUIT1_DRAGON;r=["red","green","blue"][s]||"blue"}return{char:"D",color:r,tile:l}}if(l.number>=1&&l.number<=9){if(t&&l.suit>=o.VSUIT1&&l.suit<=o.VSUIT3){const r=t[l.suit-o.VSUIT1],s=V[r]||"blue";return{char:l.number.toString(),color:s,tile:l}}return{char:l.number.toString(),color:V[l.suit]||"blue",tile:l}}if(l.number>=R.CONSECUTIVE1&&l.number<=R.CONSECUTIVE7){const r=l.number-R.CONSECUTIVE1,s=e?2+r*2:1+r*2;if(t&&l.suit>=o.VSUIT1&&l.suit<=o.VSUIT3){const i=t[l.suit-o.VSUIT1],a=V[i]||"blue";return{char:s.toString(),color:a,tile:l}}return{char:s.toString(),color:V[l.suit]||"blue",tile:l}}return l.number===0?{char:"0",color:V[l.suit]||"gray",tile:l}:{char:"?",color:"gray",tile:l}}function X(l){const e=new Map;return l.forEach(t=>{const n=`${t.suit}-${t.number}`;e.set(n,(e.get(n)||0)+1)}),e}function we(l,e,t,n,r=null,s=null,i=null,a=null){const c=X(e),u=new Map,h=(s?X(s):c).get(`${o.JOKER}-0`)||0;let g=0,f=0;return l.map((m,E)=>{let A;if(i&&m.number>=R.CONSECUTIVE1&&m.number<=R.CONSECUTIVE7){const b=i.get(m.number);if(b!==void 0){const k={...m,number:b};A=F(k,n,r,a)}else A=F(m,n,r,a)}else A=F(m,n,r,a);const y=`${m.suit}-${m.number}`,N=t[E];let p=!1;return(c.get(y)||0)-(u.get(y)||0)>0?(p=!0,u.set(y,(u.get(y)||0)+1),m.suit===o.JOKER&&g++):N>=3&&m.suit!==o.JOKER&&g+f<h&&(p=!0,f++,A.char="J",A.color="gray"),{...A,isMatched:p}})}const z={inverted:{red:"bg-red-600 text-white border border-red-700",green:"bg-green-600 text-white border border-green-700",blue:"bg-blue-600 text-white border border-blue-700",black:"bg-black text-white border border-gray-800",gray:"bg-gray-600 text-white border border-gray-700"},normal:{red:"bg-white text-red-600 border border-red-200",green:"bg-white text-green-600 border border-green-200",blue:"bg-white text-blue-600 border border-blue-200",black:"bg-white text-black border border-gray-300",gray:"bg-white text-gray-700 border border-gray-300"}};function xe(l,e=!0){const t="tile-char",n=e&&l.isMatched,r=l.color,s=n?z.inverted:z.normal,i=s[r]||s.gray;return`${t} ${i}`}function Xe(l,e,t=null){const n=[],r=[],s=l.hand.even||!1,i=new Map,a=new Map;l.componentInfoArray.forEach(p=>{const S=p.component.suit;if(S>=o.VSUIT1_DRAGON&&S<=o.VSUIT3_DRAGON&&p.tileArray&&p.tileArray.length>0){const b=p.tileArray.find(k=>k.suit===o.DRAGON);b&&a.set(S,b.number)}});const c=[];l.componentInfoArray.forEach(p=>{const S=p.component.suit;S>=o.VSUIT1_DRAGON&&S<=o.VSUIT3_DRAGON&&(c.includes(S)||c.push(S))});const u=new Set(a.values()),d=[O.RED,O.GREEN,O.WHITE],h=d.filter(p=>!u.has(p));let g=0;c.forEach(p=>{if(!a.has(p))if(g<h.length)a.set(p,h[g]),g++;else{const S=p-o.VSUIT1_DRAGON;a.set(p,d[S]||O.RED)}}),l.componentInfoArray.forEach(p=>{if(p.tileArray&&p.tileArray.length>0){const S=p.component.number;if(S>=R.CONSECUTIVE1&&S<=R.CONSECUTIVE7){const b=p.tileArray.find(k=>k.suit!==o.JOKER);if(b&&i.size===0){const k=S-R.CONSECUTIVE1,M=b.number-k;for(let _=0;_<7;_++)i.set(R.CONSECUTIVE1+_,M+_)}}}}),l.componentInfoArray.forEach((p,S)=>{const b=p.component.count,k=p.tileArray?p.tileArray.length:0;if(p.tileArray&&p.tileArray.length>0&&p.tileArray.forEach(M=>{n.push(M),r.push(b)}),k<b){let M;const _=p.component.suit;if(_>=o.VSUIT1_DRAGON&&_<=o.VSUIT3_DRAGON){const K=a.get(_);M={suit:o.DRAGON,number:K!==void 0?K:0,_originalVsuit:_}}else M={suit:_||o.INVALID,number:p.component.number||0};for(let K=k;K<b;K++)n.push(M),r.push(b)}if(S<l.componentInfoArray.length-1){const M=l.componentInfoArray[S+1];p.component.count===1&&M.component.count===1||(n.push({isSpacer:!0}),r.push(0))}});const f=n.filter(p=>!p.isSpacer),m=r.filter((p,S)=>!n[S].isSpacer),E=we(f,e,m,s,l.vsuitArray,t,i,a),A=[];let y=0;n.forEach(p=>{p.isSpacer?A.push({isSpacer:!0}):A.push(E[y++])});let N='<div class="pattern-row">';return A.forEach(p=>{p.isSpacer?N+='<span class="component-spacer"></span>':N+=`<span class="${xe(p)}">${p.char}</span>`}),N+="</div>",N}const H={KEEP:"KEEP",PASS:"PASS",DISCARD:"DISCARD"};class ze{constructor(e,t,n="medium"){this.card=e,this.tableData=t,this.difficulty=n,this.config=this.getDifficultyConfig(n)}getDifficultyConfig(e){const t={easy:{maxPatterns:2,minDiscardable:5,exposureThreshold:70,courtesyThresholds:[55,65,75],charlestonContinueThreshold:.8,blankExchangeRank:999,blankExchangeGain:999,jokerTopHands:1,jokerRankThreshold:60,jokerScaling:.8,discardRandomness:.3},medium:{maxPatterns:5,minDiscardable:4,exposureThreshold:55,courtesyThresholds:[50,60,68],charlestonContinueThreshold:.65,blankExchangeRank:85,blankExchangeGain:25,jokerTopHands:2,jokerRankThreshold:55,jokerScaling:.9,discardRandomness:.1},hard:{maxPatterns:999,minDiscardable:3,exposureThreshold:45,courtesyThresholds:[45,55,65],charlestonContinueThreshold:.6,blankExchangeRank:80,blankExchangeGain:20,jokerTopHands:3,jokerRankThreshold:50,jokerScaling:1,discardRandomness:0}};return t[e]||t.medium}calculateTileNeeds(e,t){const n=new Map;for(const r of t){const s=new Map;for(const i of r.componentInfoArray){const a=new Map;for(const c of i.tileArray)if(c.suit!==o.JOKER&&c.suit!==o.BLANK){const u=`${c.suit}-${c.number}`;a.set(u,(a.get(u)||0)+1)}for(const[c,u]of a.entries())s.set(c,(s.get(c)||0)+u)}for(const[i,a]of s.entries()){n.has(i)||n.set(i,{needed:0,have:0});const c=n.get(i);c.needed=Math.max(c.needed,a)}}for(const r of e){if(r.suit===o.JOKER||r.suit===o.BLANK)continue;const s=`${r.suit}-${r.number}`;n.has(s)||n.set(s,{needed:0,have:0}),n.get(s).have++}for(const r of n.values())r.needed=Math.min(r.needed,r.have);return n}countDiscardableTiles(e,t){const n=this.calculateTileNeeds(e,t);let r=0;for(const s of e){if(s.suit===o.JOKER||s.suit===o.BLANK)continue;const i=`${s.suit}-${s.number}`,a=n.get(i);(!a||a.needed===0)&&r++}return r}getTileRecommendations(e,t=null){const n=[],r=e.clone();for(;r.getLength()<14;)r.addTile(new D(o.INVALID,R.INVALID));const i=[...this.card.rankHandArray14(r)].sort((m,E)=>E.rank-m.rank),a=e.getTileArray();let c=i.length;this.config.maxPatterns<999&&(c=Math.min(c,this.config.maxPatterns));const u=t!==null?t:this.config.minDiscardable,d=Math.min(3,c);let h=1;for(let m=d;m>=1;m--){const E=i.slice(0,m);if(this.countDiscardableTiles(a,E)>=u){h=m;break}}c=h;const g=i.slice(0,c),f=this.calculateTileNeeds(a,g);for(const[m,E]of f.entries())I(`  ${m}: needed=${E.needed}, have=${E.have}`);for(const m of a){let E=H.DISCARD;if(m.suit===o.JOKER||m.suit===o.BLANK)E=H.KEEP;else{const A=`${m.suit}-${m.number}`,y=f.get(A);y&&y.needed>0?(E=H.KEEP,I(`  ${m.getText()}: KEEP (need.needed=${y.needed} before decrement)`),y.needed--):I(`  ${m.getText()}: DISCARD (need=${y?`${y.needed}/${y.have}`:"not found"})`)}n.push({tile:m,recommendation:E})}return n.sort((m,E)=>{const A={[H.KEEP]:0,[H.PASS]:1,[H.DISCARD]:2},y=A[m.recommendation]-A[E.recommendation];if(y===0){const N=m.tile.suit===o.JOKER||m.tile.suit===o.BLANK?1:0;return(E.tile.suit===o.JOKER||E.tile.suit===o.BLANK?1:0)-N}return y}),{recommendations:n,consideredPatternCount:c}}chooseDiscard(e){const n=this.getTileRecommendations(e,1).recommendations;let r=null;const s=n.filter(i=>i.recommendation==="DISCARD"&&i.tile.suit!==o.BLANK);if(this.config.discardRandomness>0&&Math.random()<this.config.discardRandomness&&s.length>0){const i=Math.floor(Math.random()*Math.min(3,s.length));r=s[i].tile,I(`[AIEngine] Made suboptimal discard choice (difficulty: ${this.difficulty})`)}else for(let i=n.length-1;i>=0;i--){const a=n[i].tile;if(a.suit!==o.BLANK){r=a;break}}return!r&&n.length>0&&(r=n[n.length-1].tile),r}claimDiscard(e,t,n,r=!1){const s=n.clone();if(s.addTile(e.clone()),this.card.validateHand14(s).valid)return{playerOption:J.MAHJONG,tileArray:null};const a=this.card.rankHandArray14(s);this.card.sortHandRankArray(a);const c=a[0],u=n.exposures.length>0,d=r||c.rank>this.config.exposureThreshold;if(u||!c.hand.concealed&&d){let h=null;e:for(const g of c.componentInfoArray)for(const f of g.tileArray)if(f.equals(e)){h=g;break e}if(h&&this.validateComponentForExposure(h))return{playerOption:J.EXPOSE_TILES,tileArray:h.tileArray}}return{playerOption:J.DISCARD_TILE,tileArray:[e]}}validateComponentForExposure(e){return!(e.component.count<3||e.tileArray.length!==e.component.count)}charlestonPass(e){const t=[],r=this.getTileRecommendations(e,3).recommendations;I(`[Charleston] Total recommendations: ${r.length}`),I(`[Charleston] Jokers in hand: ${r.filter(i=>i.tile.suit===o.JOKER).length}`),I(`[Charleston] Blanks in hand: ${r.filter(i=>i.tile.suit===o.BLANK).length}`);const s=r.filter(i=>!i.tile.isJoker()&&!i.tile.isBlank());I(`[Charleston] Valid recommendations after filtering: ${s.length}`),I(`[Charleston] Jokers in valid: ${s.filter(i=>i.tile.suit===o.JOKER).length}`),I(`[Charleston] Blanks in valid: ${s.filter(i=>i.tile.suit===o.BLANK).length}`),s.sort((i,a)=>{const c={[H.DISCARD]:0,[H.PASS]:1,[H.KEEP]:2};return c[i.recommendation]-c[a.recommendation]});for(let i=0;i<3;i++)if(s.length>i){const a=s[i].tile;I(`[Charleston] Passing tile ${i}: ${a.getText()} (suit=${a.suit})`),t.push(a)}return t}courtesyVote(e){const t=e.clone(),n=new D(o.INVALID,R.INVALID);t.addTile(n);const r=this.card.rankHandArray14(t);this.card.sortHandRankArray(r);const i=r[0].rank;this.card.printHandRankArray(r,1);const a=this.config.courtesyThresholds;return i<a[0]?3:i<a[1]?2:i<a[2]?1:0}charlestonContinueVote(e){const t=e.clone(),n=new D(o.INVALID,R.INVALID);t.addTile(n);const r=this.card.rankHandArray14(t);this.card.sortHandRankArray(r);const i=r[0].rank,a=this.config.charlestonContinueThreshold||.7;let c=a;const u=this.config.courtesyThresholds;return i>=u[2]?c=a+.2:i>=u[1]?c=a+.1:i>=u[0]?c=a:c=Math.max(a-.2,.3),Math.random()<c}courtesyPass(e,t){const r=this.getTileRecommendations(e,t).recommendations,s=[];for(let i=r.length-1;i>=0&&s.length<t;i--){const a=r[i].tile;a.suit===o.JOKER||a.suit===o.BLANK||s.push(a)}return s}exchangeTilesForJokers(e,t){if(!t||t.length===0)return{shouldExchange:!1,tile:null};const n=this.card.rankHandArray14(e),r=[...n].sort((c,u)=>u.rank-c.rank);let s=-1e5,i=null;const a=e.tiles;for(let c=0;c<a.length;c++){const u=a[c];let d=!1;for(const E of t)if(u.suit===E.suit&&u.number===E.number){d=!0;break}if(!d)continue;const h=e.clone();h.tiles[c]=new D(o.JOKER,0);const g=this.card.rankHandArray14(h);let f=0;const m=Math.min(this.config.jokerTopHands,r.length);for(let E=0;E<m;E++){const A=r[E],y=n.indexOf(A);let N=1;A.rank>this.config.jokerRankThreshold&&(N=Math.min(A.rank*this.config.jokerScaling,100)),f+=(g[y].rank-n[y].rank)*N}f>s&&(s=f,i=u)}return i&&s>0?{shouldExchange:!0,tile:i}:{shouldExchange:!1,tile:null}}}const Pe="modulepreload",ke=function(l){return"/mahjong/"+l},Z={},L=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(t.map(c=>{if(c=ke(c),c in Z)return;Z[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Pe,u||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((g,f)=>{h.addEventListener("load",g),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return r.then(i=>{for(const a of i||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},_e=(l,e,t)=>{const n=l[e];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((r,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})};class ve{constructor(){this.tileArray=[]}insert(e){this.tileArray.push(e)}getLength(){return this.tileArray.length}getTileArray(){return[...this.tileArray]}}class Me{constructor(){this.hiddenTileSet=new ve,this.exposedTileSetArray=[],this.even=!1}insertHidden(e){this.hiddenTileSet.insert(e)}getHiddenTileArray(){return this.hiddenTileSet.getTileArray()}getLength(){return this.hiddenTileSet.getLength()+this.exposedTileSetArray.reduce((e,t)=>e+t.getLength(),0)}getTileArray(){const e=[];e.push(...this.getHiddenTileArray());for(const t of this.exposedTileSetArray)e.push(...t.getTileArray());return e}isAllHidden(){return this.exposedTileSetArray.length===0}}class Ze{constructor(e){this.year=e,this.validHandGroups=null}async init(){const e=this.year,{validHandGroups:t}=await _e(Object.assign({"./2017/card2017.js":()=>L(()=>import("./card2017-xNUsHQkP.js"),[]),"./2017/card_test.js":()=>L(()=>import("./card_test-CSrs5fny.js"),[]),"./2018/card2018.js":()=>L(()=>import("./card2018-CfmI8crA.js"),[]),"./2018/card_test.js":()=>L(()=>import("./card_test-DlcTU_lJ.js"),[]),"./2019/card2019.js":()=>L(()=>import("./card2019-DfXoXepR.js"),[]),"./2019/card_test.js":()=>L(()=>import("./card_test-BFyACX53.js"),[]),"./2020/card2020.js":()=>L(()=>import("./card2020-0yheeuBf.js"),[]),"./2020/card_test.js":()=>L(()=>import("./card_test-nJlcc_r-.js"),[]),"./2025/card2025.js":()=>L(()=>import("./card2025-BXs0sl6B.js"),[])}),`./${e}/card${e}.js`,3);this.validHandGroups=t}generateHand(e,t){let n=t;const r=[o.CRACK,o.BAM,o.DOT],s=new Me;let i=null;n||(n=14);e:for(const u of this.validHandGroups)for(const d of u.hands)if(d.description.valueOf()===e.valueOf()){i=d;break e}if(!i)return s;const a=[];for(let u=0;u<i.components.length;u++)a.push(0);let c=0;for(let u=0;u<n;u++){const d=i.components[c];let h=d.suit,g=d.number;if(a[c]>=4)s.insertHidden(new D(o.JOKER,0));else{let m=1;s.even&&(m=2),h>=o.VSUIT1_DRAGON?(g=r[h-o.VSUIT1_DRAGON],h=o.DRAGON):h>=o.VSUIT1&&(h=r[h-o.VSUIT1],g>9&&(g=m+g-R.CONSECUTIVE1)),s.insertHidden(new D(h,g))}a[c]++;let f=!1;for(let m=0;m<i.components.length;m++)if(c++,c>=i.components.length&&(c=0),a[c]<i.components[c].count){f=!0;break}if(!f)break}return s}validateHand14(e){const t=e.getAllTilesIncludingExposures?e.getAllTilesIncludingExposures():e.getTileArray();return this.validateHand(t,e.isAllHidden())}diagnoseInvalidHand(e){const t=this.rankHandArray14(e);this.sortHandRankArray(t);const n=t[0],r=new Set;for(const c of n.componentInfoArray)for(const u of c.tileArray)r.add(u);const s=[];s.push(...e.getHiddenTileArray());for(const c of e.exposedTileSetArray)s.push(...c.tileArray);const i=[],a=[];for(const c of s)r.has(c)?i.push(c):a.push(c);return{closestHand:n.hand.description,closestGroup:n.group.groupDescription,rank:n.rank,matchingTiles:i,nonMatchingTiles:a}}validateHand13(e,t){const n=e.getTileArray();return t&&n.push(t),this.validateHand(n,e.isAllHidden())}validateHand(e,t){const n=e.filter(i=>i.suit!==o.BLANK);if(n.length!==14)return{valid:!1,tileCount:e.length,numJokers:0,minNumLow:9999,minNumHigh:9999,suits:[],allHidden:t};const r={valid:!1,tileCount:0,numJokers:0,minNumLow:9999,minNumHigh:9999,suits:[],allHidden:t};for(const i of n){let a=i.suit;a===o.DRAGON&&(a=i.number),r.suits.indexOf(a)===-1&&r.suits.push(a),a===o.JOKER&&r.numJokers++}r.minNumLow=9999,r.minNumHigh=9999;for(const i of n)(i.suit===o.CRACK||i.suit===o.BAM||i.suit===o.DOT)&&i.number<r.minNumHigh&&(r.minNumHigh=i.number);if(r.numJokers>=3?r.minNumLow=1:r.minNumLow=r.minNumHigh,r.tileCount=n.length,r.tileCount!==14)return r;let s=!1;e:for(const i of this.validHandGroups)for(const a of i.hands)if(re("Match hand: "+a.description+`
`),this.matchHand(n,r,i,a)){s=!0;break e}return s&&(r.valid=!0),r}matchHand(e,t,n,r){let s=!1;if(r.concealed&&!t.allHidden)return!1;const i=this._getEffectiveVsuitCount(r);if(t.suits.length<r.vsuitCount)return!1;const a=[[-1,-1,-1]],c=[[o.CRACK,-1,-1],[o.BAM,-1,-1],[o.DOT,-1,-1]],u=[[o.CRACK,o.BAM,-1],[o.CRACK,o.DOT,-1],[o.BAM,o.CRACK,-1],[o.BAM,o.DOT,-1],[o.DOT,o.CRACK,-1],[o.DOT,o.BAM,-1]],d=[[o.CRACK,o.BAM,o.DOT],[o.CRACK,o.DOT,o.BAM],[o.BAM,o.CRACK,o.DOT],[o.BAM,o.DOT,o.CRACK],[o.DOT,o.CRACK,o.BAM],[o.DOT,o.BAM,o.CRACK]];let h=null;switch(i){case 1:h=c;break;case 2:h=u;break;case 3:h=d;break;default:h=a;break}for(let g=t.minNumLow;g<=t.minNumHigh;g++){for(const f of h)if(s=this.matchComponents(e,t,r,f,g),s)break;if(s)break}return s}matchComponents(e,t,n,r,s){let i=!0;if(s!==9999&&(n.even&&s&1||n.odd&&!(s&1)))return!1;const a=[];for(const c of e)a.push(c);for(const c of n.components){let u=0,d=c.suit,h=c.number;d>=o.VSUIT1_DRAGON?(h=r[d-o.VSUIT1_DRAGON],d=o.DRAGON):d>=o.VSUIT1&&(d=r[d-o.VSUIT1],h>9&&(h=s+h-R.CONSECUTIVE1));let g=!1;do{g=!1;for(const f of a)if(f.suit===d&&f.number===h){g=!0;const m=a.indexOf(f);a.splice(m,1),u++;break}if(!g&&c.count>2){for(const f of a)if(f.suit===o.JOKER){g=!0;const m=a.indexOf(f);a.splice(m,1),u++;break}}}while(g&&u<c.count);if(u!==c.count){i=!1;break}}return i}printValidationInfo(e){}rankHandArray14(e){const t=[];for(const n of this.validHandGroups)for(const r of n.hands){const s={group:n,hand:r,rank:0,componentInfoArray:[],vsuitArray:null};t.push(s),this.rankHand(e,s,r)}return t}rankHand(e,t,n){if(n.concealed&&!e.isAllHidden()){t.rank=0;return}const r=this._getEffectiveVsuitCount(n),s=[[-1,-1,-1]],i=[[o.CRACK,-1,-1],[o.BAM,-1,-1],[o.DOT,-1,-1]],a=[[o.CRACK,o.BAM,-1],[o.CRACK,o.DOT,-1],[o.BAM,o.CRACK,-1],[o.BAM,o.DOT,-1],[o.DOT,o.CRACK,-1],[o.DOT,o.BAM,-1]],c=[[o.CRACK,o.BAM,o.DOT],[o.CRACK,o.DOT,o.BAM],[o.BAM,o.CRACK,o.DOT],[o.BAM,o.DOT,o.CRACK],[o.DOT,o.CRACK,o.BAM],[o.DOT,o.BAM,o.CRACK]];let u=null;switch(r){case 1:u=i;break;case 2:u=a;break;case 3:u=c;break;default:u=s;break}let d=!1;for(const m of n.components)if(m.number>9){d=!0;break}let h=1,g=1,f=1;d&&(g=9,n.odd?(h=1,g=9,f=2):n.even&&(h=2,g=8,f=2));for(let m=h;m<=g;m+=f)for(const E of u){const A=this.rankFormComponents(e,m,n,E);let y=0;for(const N of A){const p=N.component,S=N.tileArray.length;y+=100*p.count/14*(S/p.count)}y>t.rank&&(t.rank=y,t.componentInfoArray=A,t.vsuitArray=E)}}rankMatchComp(e,t,n,r){let s=n.suit,i=n.number;const a={match:!1,tileArray:[]};if(e.length===0)return a;s>=o.VSUIT1_DRAGON?(i=r[s-o.VSUIT1_DRAGON],s=o.DRAGON):s>=o.VSUIT1&&(s=r[s-o.VSUIT1],i>9&&(i=t+i-R.CONSECUTIVE1));for(const c of e){let u=!1;if((c.suit===s&&c.number===i||c.suit===o.JOKER)&&(u=!0),u&&(a.tileArray.push(c),a.tileArray.length===n.count))break}return e.length===n.count&&a.tileArray.length===n.count&&(a.match=!0),a}rankFormComponents(e,t,n,r){const s=[];for(const d of n.components){const h={component:d,tileArray:[]};s.push(h)}const i=[];for(const d of s)i.push(d);for(const d of e.exposedTileSetArray){for(const g of s){if(g.tileArray.length>0)continue;const f=this.rankMatchComp(d.tileArray,t,g.component,r);if(f.match){g.tileArray=f.tileArray;break}}let h=!0;for(const g of d.tileArray){let f=!1;for(const m of s)if(m.tileArray.includes(g)){f=!0;break}if(!f){h=!1;break}}if(!h)return s}const a=e.getHiddenTileArray(),c=[],u=[];for(const d of a)d.suit===o.JOKER?u.push(d):c.push(d);for(const d of s){const h=d.component;if(d.tileArray.length>0)continue;const g=this.rankMatchComp(c,t,h,r);d.tileArray=g.tileArray;for(const f of g.tileArray){const m=c.indexOf(f);m!==-1&&c.splice(m,1)}}for(const d of u){let h=null,g=null,f=null;for(const m of i){const E=m.component.count-m.tileArray.length;if(m.component.count>=3&&E)switch(E){case 2:h=m;break;case 1:g=m;break;default:f=m;break}}g?g.tileArray.push(d):h?h.tileArray.push(d):f&&f.tileArray.push(d)}return s}_getEffectiveVsuitCount(e){let t=-1;for(const n of e.components)if(n.suit>=o.VSUIT1_DRAGON&&n.suit<=o.VSUIT3_DRAGON){const r=n.suit-o.VSUIT1_DRAGON;t=Math.max(t,r)}else if(n.suit>=o.VSUIT1&&n.suit<=o.VSUIT3){const r=n.suit-o.VSUIT1;t=Math.max(t,r)}return t>=0?t+1:0}sortHandRankArray(e){e.sort((t,n)=>n.rank-t.rank)}printHandRankArray(e,t){let n=e.length;t&&(n=Math.min(t,n));for(let r=0;r<n;r++){const s=e[r];I("Group = "+s.group.groupDescription+`
`),I("Hand = "+s.hand.description+`
`),I("Rank = "+s.rank+`
`);let i="";for(const a of s.componentInfoArray){i+="["+a.component.count+"] ";for(const c of a.tileArray)i+=c.getText()+" "}}}}export{ze as A,Qe as B,Ze as C,O as D,qe as G,G as H,T as P,Ge as S,je as T,Fe as U,R as V,Be as W,L as _,o as a,$e as b,Je as c,I as d,Ke as e,te as f,Ye as g,We as h,C as i,Le as j,D as k,Ve as l,Ue as m,P as n,Me as o,He as p,Xe as r};
