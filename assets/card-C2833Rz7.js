const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/card_test-CKuUqMUd.js","assets/gameObjects-DOoYRX8J.js","assets/card_test-BdrJPyHI.js","assets/card_test-BWBv5XLJ.js","assets/card_test-2J8YhpN7.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function fe(d){const e=window.document.getElementById("messages");if(!e)return;const t=d.endsWith(`
`)?d:`${d}
`;e.value+=t,e.scrollTop=e.scrollHeight}function me(d){const e=window.document.getElementById("info");e.value=d}let v=function(){},G=function(){};function pe(d){const e=window.document.getElementById("hint-content");e.innerHTML=d}const O={cardYear:2025,useBlankTiles:!1,difficulty:"medium",trainingMode:!1,trainingHand:"",trainingTileCount:9,skipCharleston:!1,bgmVolume:20,bgmMuted:!1,sfxVolume:20,sfxMuted:!1},k="mahjong_";class Te{static load(){const e={};for(const[t,n]of Object.entries(O)){const s=k+t,i=localStorage.getItem(s);i===null?e[t]=n:e[t]=this.parseValue(i,typeof n)}return e}static save(e){for(const[t,n]of Object.entries(e)){if(!(t in O)){console.warn(`Unknown setting key: ${t}`);continue}const s=k+t;localStorage.setItem(s,String(n))}console.log("Settings saved:",e)}static get(e){if(!(e in O)){console.warn(`Unknown setting key: ${e}`);return}const t=k+e,n=localStorage.getItem(t);return n===null?O[e]:this.parseValue(n,typeof O[e])}static set(e,t){if(!(e in O)){console.warn(`Unknown setting key: ${e}`);return}const n=typeof O[e],s=typeof t;if(s!==n){console.error(`Type mismatch for ${e}: expected ${n}, got ${s}`);return}const i=k+e;localStorage.setItem(i,String(t)),console.log(`Setting updated: ${e} = ${t}`)}static reset(){for(const e of Object.keys(O)){const t=k+e;localStorage.removeItem(t)}console.log("Settings reset to defaults")}static getDefault(e){return O[e]}static getDefaults(){return{...O}}static parseValue(e,t){switch(t){case"number":return parseInt(e,10);case"boolean":return e==="true";case"string":return e;default:return console.warn(`Unknown type: ${t}`),e}}static isAvailable(){try{const e="__storage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.error("localStorage is not available:",e),!1}}static exportJSON(){const e=this.load();return JSON.stringify(e,null,2)}static importJSON(e){try{const t=JSON.parse(e);for(const n of Object.keys(t))if(!(n in O))return console.error(`Invalid setting key in import: ${n}`),!1;return this.save(t),!0}catch(t){return console.error("Failed to import settings:",t),!1}}static subscribe(e,t){const n=s=>{if(s.key===k+e){const i=this.parseValue(s.newValue,typeof O[e]);t(i)}};return window.addEventListener("storage",n),()=>{window.removeEventListener("storage",n)}}}const Ee=648,ge=1052,ye=69,Ae=52,Oe=.75,Se=4,E={INIT:0,START:1,DEAL:2,CHARLESTON1:3,CHARLESTON_QUERY:4,CHARLESTON2:6,COURTESY_QUERY:7,COURTESY:9,COURTESY_COMPLETE:10,LOOP_PICK_FROM_WALL:11,LOOP_CHOOSE_DISCARD:12,LOOP_QUERY_CLAIM_DISCARD:13,LOOP_EXPOSE_TILES:15,LOOP_EXPOSE_TILES_COMPLETE:16,END:17},H={EXPOSE_TILES:0,DISCARD_TILE:1,MAHJONG:2},T={BOTTOM:0,RIGHT:1,TOP:2,LEFT:3},o={CRACK:0,BAM:1,DOT:2,WIND:3,DRAGON:4,FLOWER:5,JOKER:6,BLANK:7,VSUIT1:8,VSUIT2:9,VSUIT3:10,VSUIT1_DRAGON:11,VSUIT2_DRAGON:12,VSUIT3_DRAGON:13,INVALID:99},x={CONSECUTIVE1:10,CONSECUTIVE2:11,CONSECUTIVE3:12,CONSECUTIVE4:13,CONSECUTIVE5:14,CONSECUTIVE6:15,CONSECUTIVE7:16,INVALID:99},Ce={NORTH:0,SOUTH:1,WEST:2,EAST:3},De={RED:0,GREEN:1,WHITE:2};function Ie(){return!window.settingsManager||typeof window.settingsManager.getUseBlankTiles!="function"?152:window.settingsManager.getUseBlankTiles()?160:152}class K{constructor(){this.listeners=new Map}on(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),()=>{const n=this.listeners.get(e);if(!n||n.length===0)return;const s=n.indexOf(t);s>-1&&(n.splice(s,1),n.length===0&&this.listeners.delete(e))}}once(e,t){const n=this.on(e,s=>{n(),t(s)})}emit(e,t){const n=this.listeners.get(e);n&&n.slice().forEach(s=>{try{s(t)}catch(i){console.error(`Error in event handler for ${e}:`,i)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}}const B=[{suit:o.CRACK,textArray:["Crack"],prefix:["C"],maxNum:9,count:4},{suit:o.BAM,textArray:["Bam"],prefix:["B"],maxNum:9,count:4},{suit:o.DOT,textArray:["Dot"],prefix:["D"],maxNum:9,count:4},{suit:o.WIND,textArray:["North","South","West","East"],prefix:["N","S","W","E"],maxNum:1,count:4},{suit:o.DRAGON,textArray:["Red dragon","Green dragon","White dragon"],prefix:["DC","DB","DD"],maxNum:1,count:4},{suit:o.FLOWER,textArray:["Flower"],prefix:["F1","F2","F3","F4","F1","F2","F3","F4"],maxNum:1,count:1},{suit:o.JOKER,textArray:["Joker"],prefix:["J"],maxNum:1,count:8},{suit:o.BLANK,textArray:["Blank"],prefix:["BLANK"],maxNum:1,count:8}];class A{constructor(e,t,n=-1){this.suit=e,this.number=t,this.index=n}getText(){for(const e of B)if(e.suit===this.suit){if(this.suit<=o.DOT)return`${e.textArray[0]} ${this.number}`;if(this.suit===o.WIND)return`${e.textArray[this.number]} wind`;if(this.suit===o.DRAGON)return`${e.textArray[this.number]}`;if(this.suit===o.FLOWER)return`${e.textArray[0]} ${this.number+1}`;if(this.suit===o.JOKER)return"Joker";if(this.suit===o.BLANK)return"Blank"}return this.suit===o.INVALID?"Invalid":`Unknown tile (${this.suit}:${this.number})`}equals(e){return e?this.suit===e.suit&&this.number===e.number:!1}isSameTile(e){return e?this.index===e.index:!1}clone(){return new A(this.suit,this.number,this.index)}isJoker(){return this.suit===o.JOKER}isBlank(){return this.suit===o.BLANK}isFlower(){return this.suit===o.FLOWER}isWind(){return this.suit===o.WIND}isDragon(){return this.suit===o.DRAGON}isNumberedSuit(){return this.suit>=o.CRACK&&this.suit<=o.DOT}isInvalid(){return this.suit===o.INVALID}static fromPhaserTile(e){return new A(e.suit,e.number,e.index)}toJSON(){return{suit:this.suit,number:this.number,index:this.index}}static fromJSON(e){return new A(e.suit,e.number,e.index)}}class P{constructor(){this.tiles=[],this.exposures=[]}get exposedTileSetArray(){return this.exposures}getLength(){const e=this.exposures.reduce((t,n)=>t+n.tiles.length,0);return this.tiles.length+e}getHiddenCount(){return this.tiles.length}getHiddenTileArray(){return this.tiles}getTileArray(){return this.tiles}addTile(e){this.tiles.push(e)}removeTile(e){const t=this.tiles.findIndex(n=>n.isSameTile(e));return t!==-1?(this.tiles.splice(t,1),!0):!1}addExposure(e){this.exposures.push(e)}hasTile(e){return this.tiles.some(t=>t.equals(e))}isAllHidden(){return this.exposures.length===0}countTile(e,t){return this.tiles.filter(n=>n.suit===e&&n.number===t).length}sortBySuit(){this.tiles.sort((e,t)=>e.suit!==t.suit?e.suit-t.suit:e.number-t.number)}sortByRank(){this.tiles.sort((e,t)=>e.number!==t.number?e.number-t.number:e.suit-t.suit)}clone(){const e=new P;return e.tiles=this.tiles.map(t=>t.clone()),e.exposures=this.exposures.map(t=>t.clone()),e}static fromPhaserHand(e){const t=new P,n=e.getHiddenTileArray();return t.tiles=n.map(s=>A.fromPhaserTile(s)),e.exposedTileSetArray.forEach(s=>{const i=new _;i.type=J(s.tileArray.length),i.tiles=s.tileArray.map(r=>A.fromPhaserTile(r)),t.exposures.push(i)}),t}toJSON(){return{tiles:this.tiles.map(e=>e.toJSON()),exposures:this.exposures.map(e=>e.toJSON())}}static fromJSON(e){const t=new P;return t.tiles=e.tiles.map(n=>A.fromJSON(n)),t.exposures=e.exposures.map(n=>_.fromJSON(n)),t}}class _{constructor(e={}){this.type=e.type||"",this.tiles=e.tiles||[]}clone(){const e=new _;return e.type=this.type,e.tiles=this.tiles.map(t=>t.clone()),e}toJSON(){return{type:this.type,tiles:this.tiles.map(e=>e.toJSON())}}get tileArray(){return this.tiles}getTileArray(){return this.tiles}getLength(){return this.tiles.length}static fromJSON(e){const t=new _;return t.type=e.type,t.tiles=e.tiles.map(n=>A.fromJSON(n)),t}}function J(d){return d===3?"PUNG":d===4?"KONG":d===5?"QUINT":"UNKNOWN"}class w{constructor(e,t=""){this.position=e,this.name=t||this.getDefaultName(),this.hand=new P,this.isHuman=e===T.BOTTOM,this.isCurrentTurn=!1,this.wind=""}getDefaultName(){return["You","Opponent 1","Opponent 2","Opponent 3"][this.position]||`Player ${this.position+1}`}clone(){const e=new w(this.position,this.name);return e.hand=this.hand.clone(),e.isHuman=this.isHuman,e.isCurrentTurn=this.isCurrentTurn,e.wind=this.wind,e}static fromPhaserPlayer(e){const t=new w(e.playerInfo.playerNum,e.playerInfo.name);return t.hand=P.fromPhaserHand(e.hand),t.wind=e.playerInfo.wind,t}toJSON(){return{position:this.position,name:this.name,hand:this.hand.toJSON(),isHuman:this.isHuman,isCurrentTurn:this.isCurrentTurn,wind:this.wind}}static fromJSON(e){const t=new w(e.position,e.name);return t.hand=P.fromJSON(e.hand),t.isHuman=e.isHuman,t.isCurrentTurn=e.isCurrentTurn,t.wind=e.wind,t}}function j(d,e){return{type:"STATE_CHANGED",oldState:d,newState:e,timestamp:Date.now()}}function F(d){return{type:"GAME_STARTED",players:d,timestamp:Date.now()}}function W(d=[]){return{type:"TILES_DEALT",sequence:d,timestamp:Date.now()}}function $(d,e,t={}){return{type:"TILE_DRAWN",player:d,tile:e,animation:{type:t.type||"deal-slide",fromPosition:t.fromPosition||{x:640,y:360},toPosition:t.toPosition||{x:450,y:575},duration:t.duration||400,easing:t.easing||"Quad.easeOut",...t},timestamp:Date.now()}}function q(d,e,t={}){return{type:"TILE_DISCARDED",player:d,tile:e,animation:{type:t.type||"discard-slide",fromPosition:t.fromPosition||{x:450,y:575},toPosition:t.toPosition||{x:350,y:420},duration:t.duration||300,easing:t.easing||"Power2.easeInOut",glow:t.glow||{color:1981066,alpha:.9},...t},timestamp:Date.now()}}function Y(d,e,t,n){return{type:"BLANK_EXCHANGED",player:d,blankTile:e,retrievedTile:t,discardIndex:n,timestamp:Date.now()}}function C(d,e){return{type:"HAND_UPDATED",player:d,hand:e,timestamp:Date.now()}}function b(d,e){return{type:"TURN_CHANGED",currentPlayer:d,previousPlayer:e,timestamp:Date.now()}}function Q(d,e,t){return{type:"CHARLESTON_PHASE",phase:d,passCount:e,direction:t,timestamp:Date.now()}}function X(d,e,t,n,s={}){const r={right:1,across:2,left:3}[t]||1;return{type:"CHARLESTON_PASS",fromPlayer:d,toPlayer:e,direction:t,tiles:n,animation:{type:s.type||"pass-tiles",direction:s.direction||t,duration:s.duration||500,easing:s.easing||"Sine.easeInOut",offset:r,...s},timestamp:Date.now()}}function z(d,e){return{type:"COURTESY_VOTE",player:d,vote:e,timestamp:Date.now()}}function Z(d,e,t,n={}){return{type:"COURTESY_PASS",fromPlayer:d,toPlayer:e,tiles:t,animation:{type:n.type||"courtesy-exchange",duration:n.duration||600,easing:n.easing||"Sine.easeInOut",glow:n.glow||{color:2003199,alpha:.7},...n},timestamp:Date.now()}}function ee(d,e,t,n={}){return{type:"TILES_RECEIVED",player:d,fromPlayer:t,tiles:e,animation:{type:n.type||"receive-tiles",duration:n.duration||400,easing:n.easing||"Power2.easeOut",glow:n.glow||{color:2003199,alpha:.7},...n},timestamp:Date.now()}}function te(d,e,t){return{type:"DISCARD_CLAIMED",claimingPlayer:d,tile:e,claimType:t,timestamp:Date.now()}}function ne(d,e,t,n={}){return{type:"TILES_EXPOSED",player:d,exposureType:e,tiles:t,animation:{type:n.type||"expose-tiles",duration:n.duration||300,easing:n.easing||"Power2.easeOut",effect:n.effect||"highlight",...n},timestamp:Date.now()}}function se(d,e,t){return{type:"GAME_ENDED",reason:d,winner:e,mahjong:t,timestamp:Date.now()}}function D(d,e="info"){return{type:"MESSAGE",text:d,messageType:e,timestamp:Date.now()}}const M={1:["right","across","left"],2:["left","across","right"]},ie={right:T.RIGHT,across:T.TOP,left:T.LEFT},re=[[T.BOTTOM,4],[T.RIGHT,4],[T.TOP,4],[T.LEFT,4],[T.BOTTOM,4],[T.RIGHT,4],[T.TOP,4],[T.LEFT,4],[T.BOTTOM,4],[T.RIGHT,4],[T.TOP,4],[T.LEFT,4],[T.BOTTOM,1],[T.RIGHT,1],[T.TOP,1],[T.LEFT,1],[T.BOTTOM,1]];class Re extends K{constructor(){super(),this.state=E.INIT,this.players=[],this.wallTiles=[],this.discards=[],this.currentPlayer=0,this.settings={year:2025,difficulty:"medium",useBlankTiles:!1,skipCharleston:!1},this.charlestonState={phase:0,passCount:0,continueToPhase2:!1,courtesyVotes:[]},this.gameResult={mahjong:!1,winner:-1,winningHand:null},this.aiEngine=null,this.cardValidator=null,this.wallGenerator=null}init(e={}){this.aiEngine=e.aiEngine,this.cardValidator=e.cardValidator,this.wallGenerator=e.wallGenerator||null,e.settings&&(this.settings={...this.settings,...e.settings}),this.players=[new w(T.BOTTOM,"You"),new w(T.RIGHT,"Opponent 1"),new w(T.TOP,"Opponent 2"),new w(T.LEFT,"Opponent 3")];const t=D(`Game initialized with ${this.settings.year} card`,"info");this.emit("MESSAGE",t)}async startGame(){this.setState(E.START),this.gameResult={mahjong:!1,winner:-1,winningHand:null},this.charlestonState={phase:0,passCount:0,continueToPhase2:!1,courtesyVotes:[]},this.discards=[],this.currentPlayer=T.BOTTOM,this.createWall();const e=F(this.players.map(t=>t.toJSON()));this.emit("GAME_STARTED",e),await this.dealTiles(),this.settings.skipCharleston?await this.gameLoop():await this.charlestonPhase()}createWall(){const e=this.wallGenerator?this.wallGenerator():oe(this.settings.useBlankTiles);if(!Array.isArray(e)||e.length===0)throw new Error("Failed to generate wall tiles. Wall generator returned empty set.");const t=e.map((n,s)=>L(n,s));this.wallTiles=ae(t),this.emit("WALL_CREATED",{tileCount:this.wallTiles.length}),this.emit("MESSAGE",{text:`Wall created with ${this.wallTiles.length} tiles`,type:"info"})}dealTiles(){this.setState(E.DEAL);const e=this.buildInitialDealSequence(),t=W(e);return this.emit("TILES_DEALT",t),new Promise(n=>{let s=null,i=!1;const r=()=>{i||(i=!0,s!==null&&clearTimeout(s),this.players.forEach((l,a)=>{const u=C(a,l.hand.toJSON());this.emit("HAND_UPDATED",u)}),n())};this.once("DEALING_COMPLETE",r),s=setTimeout(()=>{this.off("DEALING_COMPLETE",r),r()},3e3)})}buildInitialDealSequence(){const e=[];for(const[t,n]of re){const s=[],i=this.players[t];for(let r=0;r<n;r++){const l=this.drawTileFromWall();i.hand.addTile(l),s.push(l.toJSON())}i.hand.sortBySuit(),e.push({player:t,tiles:s})}return e}async charlestonPhase(){if(this.settings.skipCharleston){await this.gameLoop();return}this.charlestonState.phase=1,await this.executeCharlestonPasses(1),this.setState(E.CHARLESTON_QUERY),await this.queryCharlestonContinue()&&(this.charlestonState.phase=2,await this.executeCharlestonPasses(2)),await this.courtesyPhase(),await this.gameLoop()}async executeCharlestonPasses(e){const t=M[e]||M[1];for(let n=0;n<t.length;n++){const s=t[n],i=ie[s];if(typeof i!="number")continue;this.setState(e===1?E.CHARLESTON1:E.CHARLESTON2);const r=Q(e,n+1,s);this.emit("CHARLESTON_PHASE",r);const l=[];for(let a=0;a<4;a++){const u=this.players[a];let c;u.isHuman?c=await this.promptUI("CHARLESTON_PASS",{direction:s,requiredCount:3}):c=await this.aiEngine.charlestonPass(u.hand),c.forEach(p=>u.hand.removeTile(p)),l[a]=c;const h=C(a,this.players[a].hand.toJSON());this.emit("HAND_UPDATED",h);const f=(a+i)%4,m=X(a,f,s,c.map(p=>({suit:p.suit,number:p.number})),{duration:400});this.emit("CHARLESTON_PASS",m)}for(let a=0;a<4;a++){const u=a,c=(a+i)%4;l[u].forEach(f=>{this.players[c].hand.addTile(f)});const h=C(c,this.players[c].hand.toJSON());this.emit("HAND_UPDATED",h)}await this.sleep(500)}}async queryCharlestonContinue(){const e=await this.promptUI("CHARLESTON_CONTINUE",{question:"Continue Charleston to phase 2?",options:["Yes","No"]}),t=this.players.filter(s=>!s.isHuman).map(s=>this.aiEngine.charlestonContinueVote(s.hand));return[e==="Yes",...t].filter(s=>s).length>=2}async courtesyPhase(){this.setState(E.COURTESY_QUERY);const e=[];for(const n of this.players){let s;if(n.isHuman){const r=await this.promptUI("COURTESY_VOTE",{question:"Courtesy Pass: How many tiles to exchange with opposite player?",options:["0","1","2","3"]});s=parseInt(r,10),(isNaN(s)||s<0||s>3)&&(s=0)}else s=await this.aiEngine.courtesyVote(n.hand);e.push({player:n.position,vote:s});const i=z(n.position,s);this.emit("COURTESY_VOTE",i)}if(e.filter(n=>n.vote>0).length>=2){this.setState(E.COURTESY);const n=Math.min(e[0].vote,e[2].vote),s=Math.min(e[1].vote,e[3].vote);if(n>0||s>0){const i=D(`Courtesy pass approved. P0-P2 pass ${n}, P1-P3 pass ${s}.`,"info");this.emit("MESSAGE",i);const r=[];for(let a=0;a<4;a++){const u=this.players[a],c=a===0||a===2?n:s;if(c===0){r[a]=[];continue}let h;u.isHuman?h=await this.promptUI("SELECT_TILES",{question:`Select 1â€“${c} tile(s) to pass to opposite player`,minTiles:1,maxTiles:c}):h=await this.aiEngine.courtesyPass(u.hand,c),r[a]=h,h.forEach(p=>u.hand.removeTile(p));const f=(a+2)%4,m=Z(a,f,h.map(p=>({suit:p.suit,number:p.number})),{duration:500});this.emit("COURTESY_PASS",m)}for(let a=0;a<4;a++){const u=(a+2)%4,c=r[u];if(c.forEach(h=>this.players[a].hand.addTile(h)),c.length>0){const h=ee(a,c.map(f=>({suit:f.suit,number:f.number})),u,{duration:500});this.emit("TILES_RECEIVED",h)}}this.players.forEach(a=>a.hand.sortBySuit()),this.players.forEach((a,u)=>{const c=C(u,a.hand.toJSON());this.emit("HAND_UPDATED",c)});const l=D("Courtesy pass complete.","info");this.emit("MESSAGE",l)}else{const i=D("Courtesy pass skipped (opposite players must both agree).","info");this.emit("MESSAGE",i)}await this.sleep(1e3)}this.setState(E.COURTESY_COMPLETE)}async gameLoop(){for(this.setState(E.LOOP_PICK_FROM_WALL);this.state!==E.END&&this.wallTiles.length>0;){if(this.shouldDrawTile()&&(await this.pickFromWall(),this.checkMahjong())){this.endGame("mahjong");return}await this.chooseDiscard();const e=await this.queryClaimDiscard();if(e.claimed){if(this.handleDiscardClaim(e),this.gameResult.mahjong)return;await this.chooseDiscard()}else this.advanceTurn()}this.wallTiles.length===0&&!this.gameResult.mahjong&&this.endGame("wall_game")}drawTileFromWall(){if(this.wallTiles.length===0)throw new Error("Attempted to draw from an empty wall");return this.wallTiles.pop()}shouldDrawTile(){const e=this.players[this.currentPlayer];return!e||!e.hand?!1:e.hand.getLength()===13}canPlayerFormExposure(e,t){if(!e||!e.hand)return!1;const n=e.hand.tiles||[];if(n.length===0)return!1;const s=n.filter(r=>r.suit===t.suit&&r.number===t.number).length,i=n.filter(r=>r.isJoker()).length;return s+i>=2}canPlayerMahjongWithTile(e,t){if(!this.cardValidator||!e||!e.hand)return!1;const n=e.hand.clone(),s=t.clone?t.clone():new A(t.suit,t.number,t.index);n.addTile(s);const i=n.tiles,r=n.exposures.length===0;try{const l=this.cardValidator.validateHand(i,r);return!!(l&&l.valid)}catch(l){return console.error("Failed to validate hand for Mahjong check:",l),!1}}async pickFromWall(){if(this.setState(E.LOOP_PICK_FROM_WALL),this.wallTiles.length===0)return;const e=this.players[this.currentPlayer],t=this.drawTileFromWall();e.hand.addTile(t),e.hand.sortBySuit();const n=$(this.currentPlayer,t.toJSON(),{type:"wall-draw",duration:300,easing:"Quad.easeOut"});this.emit("TILE_DRAWN",n);const s=C(this.currentPlayer,e.hand.toJSON());this.emit("HAND_UPDATED",s),await this.sleep(300)}async chooseDiscard(){this.setState(E.LOOP_CHOOSE_DISCARD);const e=this.players[this.currentPlayer];let t;if(e.isHuman?t=await this.promptUI("CHOOSE_DISCARD",{hand:e.hand.toJSON()}):t=await this.aiEngine.chooseDiscard(e.hand),!t&&(console.error("chooseDiscard: No tile returned, falling back to first tile",{playerIndex:this.currentPlayer}),t=e.hand.tiles[0],!t))throw new Error("chooseDiscard: Player hand is empty, cannot discard");e.hand.removeTile(t)||console.error("chooseDiscard: Failed to remove tile from hand",{playerIndex:this.currentPlayer,tile:t}),this.discards.push(t);const s={suit:t.suit,number:t.number,index:t.index},i=q(this.currentPlayer,s,{type:"discard-slide",duration:300,easing:"Power2.easeInOut"});this.emit("TILE_DISCARDED",i);const r=C(this.currentPlayer,e.hand.toJSON());this.emit("HAND_UPDATED",r),await this.sleep(500)}async queryClaimDiscard(){this.setState(E.LOOP_QUERY_CLAIM_DISCARD);const e=this.discards[this.discards.length-1];if(!e||e.isJoker()||e.isBlank())return{claimed:!1};for(let t=1;t<=3;t++){const n=(this.currentPlayer+t)%4,s=this.players[n];let i;if(s.isHuman){const r=this.canPlayerFormExposure(s,e),l=this.canPlayerMahjongWithTile(s,e);if(!r&&!l)continue;i=await this.promptUI("CLAIM_DISCARD",{tile:e.toJSON(),options:["Mahjong","Pung","Kong","Pass"]})}else{const r=await this.aiEngine.claimDiscard(e,n,s.hand);if(r.playerOption===H.MAHJONG)i="Mahjong";else if(r.playerOption===H.EXPOSE_TILES){const l=r.tileArray.length;l===3?i="Pung":l===4?i="Kong":l===5&&(i="Quint")}else i="Pass"}if(i!=="Pass")return{claimed:!0,player:n,claimType:i}}return{claimed:!1}}exchangeBlankWithDiscard(e,t){if(!this.settings.useBlankTiles)throw new Error("Blank exchange is disabled (house rule off)");if(this.state!==E.LOOP_CHOOSE_DISCARD)throw new Error("Blank exchange only allowed during discard selection");const n=this.players[T.BOTTOM];if(!n||!n.isHuman)throw new Error("Blank exchange only available to human player");const s=L(e),i=L(t);if(!s.isBlank())throw new Error("Selected tile is not a blank");if(!n.hand.removeTile(s))throw new Error("Blank tile not found in hand");const l=this.discards.findIndex(m=>m.isSameTile(i));if(l===-1)throw new Error("Selected discard tile no longer available");if(this.discards[l].isJoker())throw new Error("Cannot exchange blank for a joker");const[u]=this.discards.splice(l,1);this.discards.push(s),n.hand.addTile(u),n.hand.sortBySuit();const c=Y(T.BOTTOM,s.toJSON(),u.toJSON(),this.discards.length-1);this.emit("BLANK_EXCHANGED",c);const h=C(T.BOTTOM,n.hand.toJSON());this.emit("HAND_UPDATED",h);const f=D(`Blank exchanged for ${u.getText()} from discards.`,"info");return this.emit("MESSAGE",f),!0}handleDiscardClaim(e){const{player:t,claimType:n}=e,s=this.discards.pop(),i=this.players[t];if(n==="Mahjong"){this.gameResult.mahjong=!0,this.gameResult.winner=t,this.endGame("mahjong");return}i.hand.addTile(s);const r={suit:s.suit,number:s.number,index:s.index},l=te(t,r,n);this.emit("DISCARD_CLAIMED",l),this.setState(E.LOOP_EXPOSE_TILES),this.exposeTiles(t,n,s),this.currentPlayer=t;const a=b(this.currentPlayer,(this.currentPlayer+3)%4);this.emit("TURN_CHANGED",a)}exposeTiles(e,t,n){const s=this.players[e],i=s.hand.tiles.filter(y=>y.equals(n)&&!y.isSameTile(n)),r=s.hand.tiles.filter(y=>y.isJoker()),l=t==="Pung"?2:t==="Kong"?3:4;if(i.length+r.length<l){console.warn("Exposure attempted without enough tiles",{playerIndex:e,exposureType:t,claimedTile:n}),this.setState(E.LOOP_EXPOSE_TILES_COMPLETE);return}s.hand.removeTile(n)||console.warn("Failed to remove claimed tile from hand during exposure",{playerIndex:e,claimedTile:n});const c=i.slice(0,Math.min(l,i.length)),h=l-c.length,f=r.slice(0,Math.max(0,h)),m=[n,...c,...f];[...c,...f].forEach(y=>{s.hand.removeTile(y)||console.warn("Failed to remove tile during exposure",{playerIndex:e,tile:y})});const p=new _({type:t.toUpperCase(),tiles:m});s.hand.addExposure(p);const g=ne(e,t,m.map(y=>({suit:y.suit,number:y.number,index:y.index})),{duration:300});this.emit("TILES_EXPOSED",g);const S=C(e,s.hand.toJSON());this.emit("HAND_UPDATED",S),this.setState(E.LOOP_EXPOSE_TILES_COMPLETE)}checkMahjong(){const e=this.players[this.currentPlayer];if(e.hand.getLength()!==14)return!1;if(this.cardValidator){const t=e.hand.tiles,n=e.hand.exposures.length===0,s=this.cardValidator.validateHand(t,n);if(s&&s.valid)return this.gameResult.mahjong=!0,this.gameResult.winner=this.currentPlayer,!0}return!1}advanceTurn(){const e=this.currentPlayer;this.currentPlayer=(this.currentPlayer+1)%4,this.players[e].isCurrentTurn=!1,this.players[this.currentPlayer].isCurrentTurn=!0;const t=b(this.currentPlayer,e);this.emit("TURN_CHANGED",t)}endGame(e){this.setState(E.END);const t=se(e,this.gameResult.winner,this.gameResult.mahjong);if(this.emit("GAME_ENDED",t),e==="mahjong"){const n=this.players[this.gameResult.winner],s=D(`${n.name} wins with Mahjong!`,"info");this.emit("MESSAGE",s)}else if(e==="wall_game"){const n=D("Wall game - no winner","info");this.emit("MESSAGE",n)}}setState(e){const t=this.state;this.state=e;const n=j(t,e);this.emit("STATE_CHANGED",n)}onSortHandRequest(e="suit"){const t=this.players[T.BOTTOM];if(!t||!t.hand)return;e==="rank"?t.hand.sortByRank():t.hand.sortBySuit();const n=C(T.BOTTOM,t.hand.toJSON());this.emit("HAND_UPDATED",n)}onExchangeJoker(){const e=this.players[T.BOTTOM];if(!e||!e.hand)return!1;if([E.INIT,E.DEAL,E.CHARLESTON1,E.CHARLESTON2,E.CHARLESTON_QUERY,E.COURTESY_QUERY,E.COURTESY].includes(this.state))return this.emit("MESSAGE",D("Cannot exchange jokers during this phase","warning")),!1;const n=[];for(let m=0;m<4;m++)this.players[m].hand.exposures.forEach((g,S)=>{g.tiles.forEach((y,N)=>{y.suit===o.JOKER&&n.push({playerIndex:m,exposureIndex:S,tileIndex:N,jokerTile:y,requiredTiles:this.getRequiredTilesForJoker(g)})})});if(n.length===0)return this.emit("MESSAGE",D("No exposed jokers available","info")),!1;const s=n.filter(m=>m.requiredTiles.some(p=>e.hand.tiles.some(g=>g.suit===p.suit&&g.number===p.number)));if(s.length===0)return this.emit("MESSAGE",D("No matching tiles to exchange","info")),!1;const i=s[0],r=i.requiredTiles[0],l=e.hand.tiles.findIndex(m=>m.suit===r.suit&&m.number===r.number);if(l===-1)return!1;const a=e.hand.tiles[l],u=i.jokerTile;e.hand.removeTile(a),e.hand.addTile(u);const c=this.players[i.playerIndex];c.hand.exposures[i.exposureIndex].tiles[i.tileIndex]=a,this.emit("JOKER_SWAPPED",{player:i.playerIndex,exposureIndex:i.exposureIndex,jokerIndex:u.index,replacementTile:a,recipient:T.BOTTOM});const h=C(T.BOTTOM,e.hand.toJSON());this.emit("HAND_UPDATED",h);const f=C(i.playerIndex,c.hand.toJSON());return this.emit("HAND_UPDATED",f),this.emit("MESSAGE",D(`Exchanged ${a.getText()} for joker`,"info")),!0}getRequiredTilesForJoker(e){const t=e.tiles.filter(n=>n.suit!==o.JOKER);return t.length>0?[t[0]]:[]}promptUI(e,t){return new Promise(n=>{this.emit("UI_PROMPT",{promptType:e,options:t,callback:s=>n(s)})})}sleep(e){return new Promise(t=>setTimeout(t,e))}getGameState(){return{state:this.state,currentPlayer:this.currentPlayer,players:this.players.map(e=>e.toJSON()),wallCount:this.wallTiles.length,discardCount:this.discards.length,gameResult:this.gameResult}}}function L(d,e=-1){if(d instanceof A)return d.clone();if(d&&typeof d=="object"&&typeof d.suit=="number"){const t=typeof d.index=="number"?d.index:e;return new A(d.suit,d.number??0,t)}throw new Error("Wall generator produced invalid tile data")}function oe(d=!1){const e=[];let t=0;for(const n of B){if(n.suit===o.BLANK&&!d)continue;const s=Array.isArray(n.prefix)?n.prefix:[n.prefix];for(const i of s)for(let r=1;r<=n.maxNum;r++){let l=r;n.maxNum===1&&(n.suit===o.FLOWER?l=0:l=s.indexOf(i));for(let a=0;a<n.count;a++)e.push(new A(n.suit,l,t++))}}return e}function ae(d){const e=d.slice();for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}const I={KEEP:"KEEP",PASS:"PASS",DISCARD:"DISCARD"};class we{constructor(e,t,n="medium"){this.card=e,this.tableData=t,this.difficulty=n,this.config=this.getDifficultyConfig(n)}getDifficultyConfig(e){const t={easy:{maxPatterns:2,minDiscardable:5,exposureThreshold:70,courtesyThresholds:[55,65,75],charlestonContinueThreshold:.8,blankExchangeRank:999,blankExchangeGain:999,jokerTopHands:1,jokerRankThreshold:60,jokerScaling:.8,discardRandomness:.3},medium:{maxPatterns:5,minDiscardable:4,exposureThreshold:55,courtesyThresholds:[50,60,68],charlestonContinueThreshold:.65,blankExchangeRank:85,blankExchangeGain:25,jokerTopHands:2,jokerRankThreshold:55,jokerScaling:.9,discardRandomness:.1},hard:{maxPatterns:999,minDiscardable:3,exposureThreshold:45,courtesyThresholds:[45,55,65],charlestonContinueThreshold:.6,blankExchangeRank:80,blankExchangeGain:20,jokerTopHands:3,jokerRankThreshold:50,jokerScaling:1,discardRandomness:0}};return t[e]||t.medium}calculateTileNeeds(e,t){const n=new Map;for(const s of t){const i=new Map;for(const r of s.componentInfoArray)for(const l of r.tileArray){const a=`${l.suit}-${l.number}`;i.set(a,(i.get(a)||0)+1)}for(const[r,l]of i.entries()){n.has(r)||n.set(r,{needed:0,have:0});const a=n.get(r);a.needed=Math.max(a.needed,l)}}for(const s of e){if(s.suit===o.JOKER||s.suit===o.BLANK)continue;const i=`${s.suit}-${s.number}`;n.has(i)||n.set(i,{needed:0,have:0}),n.get(i).have++}for(const s of n.values())s.needed=Math.min(s.needed,s.have);return n}countDiscardableTiles(e,t){const n=this.calculateTileNeeds(e,t);let s=0;for(const i of e){if(i.suit===o.JOKER||i.suit===o.BLANK)continue;const r=`${i.suit}-${i.number}`,l=n.get(r);(!l||l.needed===0)&&s++}return s}getTileRecommendations(e){const t=[],s=[...this.card.rankHandArray14(e)].sort((u,c)=>c.rank-u.rank),i=e.getTileArray();let r=s.length;for(this.config.maxPatterns<999&&(r=Math.min(r,this.config.maxPatterns));r>1;){const u=s.slice(0,r);if(this.countDiscardableTiles(i,u)>=this.config.minDiscardable)break;r--}r===0&&(r=1);const l=s.slice(0,r),a=this.calculateTileNeeds(i,l);for(const u of i){let c=I.DISCARD;if(u.suit===o.JOKER||u.suit===o.BLANK)c=I.KEEP;else{const h=`${u.suit}-${u.number}`,f=a.get(h);f&&f.needed>0&&(c=I.KEEP,f.needed--)}t.push({tile:u,recommendation:c})}return t.sort((u,c)=>{const h={[I.KEEP]:0,[I.PASS]:1,[I.DISCARD]:2},f=h[u.recommendation]-h[c.recommendation];if(f===0){const m=u.tile.suit===o.JOKER||u.tile.suit===o.BLANK?1:0;return(c.tile.suit===o.JOKER||c.tile.suit===o.BLANK?1:0)-m}return f}),{recommendations:t,consideredPatternCount:r}}chooseDiscard(e){const n=this.getTileRecommendations(e).recommendations;let s=null;const i=n.filter(r=>r.recommendation==="DISCARD"&&r.tile.suit!==o.BLANK);if(this.config.discardRandomness>0&&Math.random()<this.config.discardRandomness&&i.length>0){const r=Math.floor(Math.random()*Math.min(3,i.length));s=i[r].tile}else for(let r=n.length-1;r>=0;r--){const l=n[r].tile;if(l.suit!==o.BLANK){s=l;break}}return!s&&n.length>0&&(s=n[n.length-1].tile),s}claimDiscard(e,t,n,s=!1){const i=n.clone();if(i.addTile(e.clone()),this.card.validateHand14(i).valid)return{playerOption:H.MAHJONG,tileArray:null};const l=this.card.rankHandArray14(i);this.card.sortHandRankArray(l);const a=l[0],u=n.exposures.length>0,c=s||a.rank>this.config.exposureThreshold;if(u||!a.hand.concealed&&c){let h=null;e:for(const f of a.componentInfoArray)for(const m of f.tileArray)if(m.equals(e)){h=f;break e}if(h&&this.validateComponentForExposure(h))return{playerOption:H.EXPOSE_TILES,tileArray:h.tileArray}}return{playerOption:H.DISCARD_TILE,tileArray:[e]}}validateComponentForExposure(e){return!(e.component.count<3||e.tileArray.length!==e.component.count)}charlestonPass(e){const t=[],n=e.clone(),s=new A(o.INVALID,x.INVALID);n.addTile(s);const l=this.getTileRecommendations(n).recommendations.filter(a=>!a.tile.equals(s)&&a.tile.suit!==o.JOKER&&a.tile.suit!==o.BLANK);l.sort((a,u)=>{const c={[I.DISCARD]:0,[I.PASS]:1,[I.KEEP]:2};return c[a.recommendation]-c[u.recommendation]});for(let a=0;a<3;a++)if(l.length>a){const u=l[a].tile;t.push(u)}return t}courtesyVote(e){const t=e.clone(),n=new A(o.INVALID,x.INVALID);t.addTile(n);const s=this.card.rankHandArray14(t);this.card.sortHandRankArray(s);const r=s[0].rank;this.card.printHandRankArray(s,1);const l=this.config.courtesyThresholds;return r<l[0]?3:r<l[1]?2:r<l[2]?1:0}charlestonContinueVote(e){const t=e.clone(),n=new A(o.INVALID,x.INVALID);t.addTile(n);const s=this.card.rankHandArray14(t);this.card.sortHandRankArray(s);const r=s[0].rank,l=this.config.charlestonContinueThreshold||.7;let a=l;const u=this.config.courtesyThresholds;return r>=u[2]?a=l+.2:r>=u[1]?a=l+.1:r>=u[0]?a=l:a=Math.max(l-.2,.3),Math.random()<a}courtesyPass(e,t){const s=this.getTileRecommendations(e).recommendations,i=[];for(let r=s.length-1;r>=0&&i.length<t;r--){const l=s[r].tile;l.suit===o.JOKER||l.suit===o.BLANK||i.push(l)}return i}exchangeTilesForJokers(e,t){if(!t||t.length===0)return{shouldExchange:!1,tile:null};const n=this.card.rankHandArray14(e),s=[...n].sort((a,u)=>u.rank-a.rank);let i=-1e5,r=null;const l=e.tiles;for(let a=0;a<l.length;a++){const u=l[a];let c=!1;for(const g of t)if(u.suit===g.suit&&u.number===g.number){c=!0;break}if(!c)continue;const h=e.clone();h.tiles[a]=new A(o.JOKER,0);const f=this.card.rankHandArray14(h);let m=0;const p=Math.min(this.config.jokerTopHands,s.length);for(let g=0;g<p;g++){const S=s[g],y=n.indexOf(S);let N=1;S.rank>this.config.jokerRankThreshold&&(N=Math.min(S.rank*this.config.jokerScaling,100)),m+=(f[y].rank-n[y].rank)*N}m>i&&(i=m,r=u)}return r&&i>0?{shouldExchange:!0,tile:r}:{shouldExchange:!1,tile:null}}}const le="modulepreload",ce=function(d){return"/mahjong/"+d},V={},R=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));s=Promise.allSettled(t.map(a=>{if(a=ce(a),a in V)return;V[a]=!0;const u=a.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":le,u||(h.as="script"),h.crossOrigin="",h.href=a,l&&h.setAttribute("nonce",l),document.head.appendChild(h),u)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${a}`)))})}))}function i(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return s.then(r=>{for(const l of r||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},ue=(d,e,t)=>{const n=d[e];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((s,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})};class he{constructor(){this.tileArray=[]}insert(e){this.tileArray.push(e)}getLength(){return this.tileArray.length}getTileArray(){return[...this.tileArray]}}class de{constructor(){this.hiddenTileSet=new he,this.exposedTileSetArray=[],this.even=!1}insertHidden(e){this.hiddenTileSet.insert(e)}getHiddenTileArray(){return this.hiddenTileSet.getTileArray()}getLength(){return this.hiddenTileSet.getLength()+this.exposedTileSetArray.reduce((e,t)=>e+t.getLength(),0)}getTileArray(){const e=[];e.push(...this.getHiddenTileArray());for(const t of this.exposedTileSetArray)e.push(...t.getTileArray());return e}isAllHidden(){return this.exposedTileSetArray.length===0}}class Ne{constructor(e){this.year=e,this.validHandGroups=null}async init(){const e=this.year,{validHandGroups:t}=await ue(Object.assign({"./2017/card2017.js":()=>R(()=>import("./card2017-CrQPvadJ.js"),[]),"./2017/card_test.js":()=>R(()=>import("./card_test-CKuUqMUd.js"),__vite__mapDeps([0,1])),"./2018/card2018.js":()=>R(()=>import("./card2018-DtcTvKjA.js"),[]),"./2018/card_test.js":()=>R(()=>import("./card_test-BdrJPyHI.js"),__vite__mapDeps([2,1])),"./2019/card2019.js":()=>R(()=>import("./card2019-CagJ2qwJ.js"),[]),"./2019/card_test.js":()=>R(()=>import("./card_test-BWBv5XLJ.js"),__vite__mapDeps([3,1])),"./2020/card2020.js":()=>R(()=>import("./card2020-CE1PTkOC.js"),[]),"./2020/card_test.js":()=>R(()=>import("./card_test-2J8YhpN7.js"),__vite__mapDeps([4,1])),"./2025/card2025.js":()=>R(()=>import("./card2025-CX8AnGZs.js"),[])}),`./${e}/card${e}.js`,3);this.validHandGroups=t}generateHand(e,t){let n=t;const s=[o.CRACK,o.BAM,o.DOT],i=new de;let r=null;n||(n=14);e:for(const u of this.validHandGroups)for(const c of u.hands)if(c.description.valueOf()===e.valueOf()){r=c;break e}if(!r)return i;const l=[];for(let u=0;u<r.components.length;u++)l.push(0);let a=0;for(let u=0;u<n;u++){const c=r.components[a];let h=c.suit,f=c.number;if(l[a]>=4)i.insertHidden(new A(o.JOKER,0));else{let p=1;i.even&&(p=2),h>=o.VSUIT1_DRAGON?(f=s[h-o.VSUIT1_DRAGON],h=o.DRAGON):h>=o.VSUIT1&&(h=s[h-o.VSUIT1],f>9&&(f=p+f-x.CONSECUTIVE1)),i.insertHidden(new A(h,f))}l[a]++;let m=!1;for(let p=0;p<r.components.length;p++)if(a++,a>=r.components.length&&(a=0),l[a]<r.components[a].count){m=!0;break}if(!m)break}return i}validateHand14(e){const t=e.getTileArray();return this.validateHand(t,e.isAllHidden())}diagnoseInvalidHand(e){const t=this.rankHandArray14(e);this.sortHandRankArray(t);const n=t[0],s=new Set;for(const a of n.componentInfoArray)for(const u of a.tileArray)s.add(u);const i=[];i.push(...e.getHiddenTileArray());for(const a of e.exposedTileSetArray)i.push(...a.tileArray);const r=[],l=[];for(const a of i)s.has(a)?r.push(a):l.push(a);return{closestHand:n.hand.description,closestGroup:n.group.groupDescription,rank:n.rank,matchingTiles:r,nonMatchingTiles:l}}validateHand13(e,t){const n=e.getTileArray();return t&&n.push(t),this.validateHand(n,e.isAllHidden())}validateHand(e,t){const n=e.filter(r=>r.suit!==o.BLANK);if(n.length!==14)return{valid:!1,tileCount:e.length,numJokers:0,minNumLow:9999,minNumHigh:9999,suits:[],allHidden:t};const s={valid:!1,tileCount:0,numJokers:0,minNumLow:9999,minNumHigh:9999,suits:[],allHidden:t};for(const r of n){let l=r.suit;l===o.DRAGON&&(l=r.number),s.suits.indexOf(l)===-1&&s.suits.push(l),l===o.JOKER&&s.numJokers++}s.minNumLow=9999,s.minNumHigh=9999;for(const r of n)(r.suit===o.CRACK||r.suit===o.BAM||r.suit===o.DOT)&&r.number<s.minNumHigh&&(s.minNumHigh=r.number);if(s.numJokers>=3?s.minNumLow=1:s.minNumLow=s.minNumHigh,s.tileCount=n.length,s.tileCount!==14)return s;let i=!1;e:for(const r of this.validHandGroups)for(const l of r.hands)if(G("Match hand: "+l.description+`
`),this.matchHand(n,s,r,l)){i=!0;break e}return i&&(s.valid=!0),s}matchHand(e,t,n,s){let i=!1;if(s.concealed&&!t.allHidden||t.suits.length<s.vsuitCount)return!1;const r=[[-1,-1,-1]],l=[[o.CRACK,-1,-1],[o.BAM,-1,-1],[o.DOT,-1,-1]],a=[[o.CRACK,o.BAM,-1],[o.CRACK,o.DOT,-1],[o.BAM,o.CRACK,-1],[o.BAM,o.DOT,-1],[o.DOT,o.CRACK,-1],[o.DOT,o.BAM,-1]],u=[[o.CRACK,o.BAM,o.DOT],[o.CRACK,o.DOT,o.BAM],[o.BAM,o.CRACK,o.DOT],[o.BAM,o.DOT,o.CRACK],[o.DOT,o.CRACK,o.BAM],[o.DOT,o.BAM,o.CRACK]];let c=null;switch(s.vsuitCount){case 1:c=l;break;case 2:c=a;break;case 3:c=u;break;default:c=r;break}for(let h=t.minNumLow;h<=t.minNumHigh;h++){for(const f of c)if(i=this.matchComponents(e,t,s,f,h),i)break;if(i)break}return i}matchComponents(e,t,n,s,i){let r=!0;if(i!==9999&&(n.even&&i&1||n.odd&&!(i&1)))return!1;const l=[];for(const a of e)l.push(a);for(const a of n.components){let u=0,c=a.suit,h=a.number;c>=o.VSUIT1_DRAGON?(h=s[c-o.VSUIT1_DRAGON],c=o.DRAGON):c>=o.VSUIT1&&(c=s[c-o.VSUIT1],h>9&&(h=i+h-x.CONSECUTIVE1));let f=!1;do{f=!1;for(const m of l)if(m.suit===c&&m.number===h){f=!0;const p=l.indexOf(m);l.splice(p,1),u++;break}if(!f&&a.count>2){for(const m of l)if(m.suit===o.JOKER){f=!0;const p=l.indexOf(m);l.splice(p,1),u++;break}}}while(f&&u<a.count);if(u!==a.count){r=!1;break}}return r}printValidationInfo(e){}rankHandArray14(e){const t=[];for(const n of this.validHandGroups)for(const s of n.hands){const i={group:n,hand:s,rank:0,componentInfoArray:[],vsuitArray:null};t.push(i),this.rankHand(e,i,s)}return t}rankHand(e,t,n){if(n.concealed&&!e.isAllHidden()){t.rank=0;return}const s=[[-1,-1,-1]],i=[[o.CRACK,-1,-1],[o.BAM,-1,-1],[o.DOT,-1,-1]],r=[[o.CRACK,o.BAM,-1],[o.CRACK,o.DOT,-1],[o.BAM,o.CRACK,-1],[o.BAM,o.DOT,-1],[o.DOT,o.CRACK,-1],[o.DOT,o.BAM,-1]],l=[[o.CRACK,o.BAM,o.DOT],[o.CRACK,o.DOT,o.BAM],[o.BAM,o.CRACK,o.DOT],[o.BAM,o.DOT,o.CRACK],[o.DOT,o.CRACK,o.BAM],[o.DOT,o.BAM,o.CRACK]];let a=null;switch(n.vsuitCount){case 1:a=i;break;case 2:a=r;break;case 3:a=l;break;default:a=s;break}let u=!1;for(const m of n.components)if(m.number>9){u=!0;break}let c=1,h=1,f=1;u&&(h=9,n.odd?(c=1,h=9,f=2):n.even&&(c=2,h=8,f=2));for(let m=c;m<=h;m+=f)for(const p of a){const g=this.rankFormComponents(e,m,n,p);let S=0;for(const y of g){const N=y.component,U=y.tileArray.length;S+=100*N.count/14*(U/N.count)}S>t.rank&&(t.rank=S,t.componentInfoArray=g,t.vsuitArray=p)}}rankMatchComp(e,t,n,s){let i=n.suit,r=n.number;const l={match:!1,tileArray:[]};if(e.length===0)return l;i>=o.VSUIT1_DRAGON?(r=s[i-o.VSUIT1_DRAGON],i=o.DRAGON):i>=o.VSUIT1&&(i=s[i-o.VSUIT1],r>9&&(r=t+r-x.CONSECUTIVE1));for(const a of e){let u=!1;if((a.suit===i&&a.number===r||a.suit===o.JOKER)&&(u=!0),u&&(l.tileArray.push(a),l.tileArray.length===n.count))break}return e.length===n.count&&l.tileArray.length===n.count&&(l.match=!0),l}rankFormComponents(e,t,n,s){const i=[];for(const c of n.components){const h={component:c,tileArray:[]};i.push(h)}const r=[];for(const c of i)r.push(c);for(const c of e.exposedTileSetArray){for(const f of i){if(f.tileArray.length>0)continue;const m=this.rankMatchComp(c.tileArray,t,f.component,s);if(m.match){f.tileArray=m.tileArray;break}}let h=!0;for(const f of c.tileArray){let m=!1;for(const p of i)if(p.tileArray.includes(f)){m=!0;break}if(!m){h=!1;break}}if(!h)return i}const l=e.getHiddenTileArray(),a=[],u=[];for(const c of l)c.suit===o.JOKER?u.push(c):a.push(c);for(const c of i){const h=c.component;if(c.tileArray.length>0)continue;const f=this.rankMatchComp(a,t,h,s);c.tileArray=f.tileArray;for(const m of f.tileArray){const p=a.indexOf(m);p!==-1&&a.splice(p,1)}}for(const c of u){let h=null,f=null,m=null;for(const p of r){const g=p.component.count-p.tileArray.length;if(p.component.count>=3&&g)switch(g){case 2:h=p;break;case 1:f=p;break;default:m=p;break}}f?f.tileArray.push(c):h?h.tileArray.push(c):m&&m.tileArray.push(c)}return i}sortHandRankArray(e){e.sort((t,n)=>n.rank-t.rank)}printHandRankArray(e,t){let n=e.length;t&&(n=Math.min(t,n));for(let s=0;s<n;s++){const i=e[s];v("Group = "+i.group.groupDescription+`
`),v("Hand = "+i.hand.description+`
`),v("Rank = "+i.rank+`
`);let r="";for(const l of i.componentInfoArray){r+="["+l.component.count+"] ";for(const a of l.tileArray)r+=a.getText()+" "}}}}export{we as A,Ne as C,De as D,Re as G,T as P,Te as S,Se as T,x as V,Ee as W,H as a,o as b,ge as c,v as d,Ae as e,ye as f,Ie as g,Oe as h,E as i,me as j,A as k,Ce as l,pe as m,de as n,fe as p};
