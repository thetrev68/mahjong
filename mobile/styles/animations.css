/* ===== Tile Draw Animation (Movement-Based) ===== */
@keyframes tile-draw {
    0% {
        transform: translate3d(var(--start-x, 0px), var(--start-y, 0px), 0) scale(0.3);
        opacity: 0;
        filter: blur(2px);
    }

    60% {
        transform: translate3d(
            calc(var(--start-x, 0px) + var(--movement-dx, 0px) * 0.7),
            calc(var(--start-y, 0px) + var(--movement-dy, 0px) * 0.7),
            0
        ) scale(1.1);
        opacity: 0.8;
        filter: blur(0px);
    }

    100% {
        transform: translate3d(var(--end-x, 0px), var(--end-y, 0px), 0) scale(1);
        opacity: 1;
        filter: blur(0px);
    }
}

.tile-drawing {
    animation: tile-draw var(--tile-draw-duration, 300ms) var(--tile-draw-easing, ease-out) forwards;
    transform-style: preserve-3d;
    backface-visibility: hidden;
}

/* ===== Tile Discard Animation (Movement-Based) ===== */
@keyframes tile-discard {
    0% {
        transform: translate3d(var(--start-x, 0px), var(--start-y, 0px), 0) scale(1);
        opacity: 1;
        filter: brightness(1);
    }

    30% {
        transform: translate3d(
            calc(var(--start-x, 0px) + var(--movement-dx, 0px) * 0.3),
            calc(var(--start-y, 0px) + var(--movement-dy, 0px) * 0.3),
            0
        ) scale(1.05);
        opacity: 0.9;
        filter: brightness(1.1);
    }

    70% {
        transform: translate3d(
            calc(var(--start-x, 0px) + var(--movement-dx, 0px) * 0.85),
            calc(var(--start-y, 0px) + var(--movement-dy, 0px) * 0.85),
            0
        ) scale(0.95);
        opacity: 0.6;
        filter: brightness(0.9);
    }

    100% {
        transform: translate3d(var(--target-x, 0px), var(--target-y, 0px), 0) scale(0.8);
        opacity: 0;
        filter: brightness(0.8);
    }
}

.tile-discarding {
    animation: tile-discard var(--tile-discard-duration, 400ms) var(--tile-discard-easing, ease-in) forwards;
    transform-style: preserve-3d;
    backface-visibility: hidden;
}

/* ===== Tile Claim Animations (Performant) ===== */
@keyframes claim-pulse-scale {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); } /* Keeps the original scaling effect */
}

@keyframes claim-pulse-glow {
    0%, 100% { opacity: 0; }
    50% { opacity: 1; }
}

.tile-claiming-pulse {
    position: relative; /* Required for pseudo-element */
    animation: claim-pulse-scale 500ms ease-in-out;
}

.tile-claiming-pulse::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border-radius: inherit; /* Match tile's border-radius */
    box-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 8px rgba(255, 255, 255, 0.5); /* A richer glow */
    opacity: 0; /* Animation controls visibility */
    animation: claim-pulse-glow 500ms ease-in-out;
    z-index: -1; /* Behind the tile */
    will-change: opacity;
}

@keyframes claim-move {
    0% {
        transform: translate3d(var(--start-x, 0px), var(--start-y, 0px), 0) scale(1);
        opacity: 1;
        filter: brightness(1);
    }

    50% {
        transform: translate3d(
            calc(var(--start-x, 0px) + var(--movement-dx, 0px) * 0.5),
            calc(var(--start-y, 0px) + var(--movement-dy, 0px) * 0.5),
            0
        ) scale(1.1);
        opacity: 0.8;
        filter: brightness(1.2);
    }

    100% {
        transform: translate3d(var(--target-x, 0px), var(--target-y, 0px), 0) scale(0.9);
        opacity: 0.6;
        filter: brightness(0.9);
    }
}

.tile-claiming-move {
    animation: claim-move var(--tile-claim-duration, 300ms) ease-out forwards;
}

/* ===== Turn Indicator Animations ===== */
@keyframes turn-start {
    0% {
        border-left-width: 0;
        box-shadow: none;
    }

    50% {
        border-left-width: 8px;
        box-shadow: 0 0 24px rgba(255, 215, 0, 1);
    }

    100% {
        border-left-width: 4px;
        box-shadow: 0 0 12px rgba(255, 215, 0, 0.6);
    }
}

.turn-starting {
    animation: turn-start 600ms ease-out forwards;
}

@keyframes turn-end {
    0% {
        border-left-width: 4px;
        box-shadow: 0 0 12px rgba(255, 215, 0, 0.6);
    }

    100% {
        border-left-width: 0;
        box-shadow: none;
    }
}

.turn-ending {
    animation: turn-end 300ms ease-in forwards;
}

/* ===== Hand Sort Animation ===== */
@keyframes hand-sort {

    0%,
    100% {
        transform: translateY(0);
    }

    50% {
        transform: translateY(-10px);
    }
}

.hand-sorting .mobile-tile {
    animation: hand-sort 400ms ease-in-out;
}

/* ===== Exposure Animation ===== */
@keyframes tile-expose {
    0% {
        transform: translate3d(0, 0, 0) rotate(0deg);
        opacity: 1;
    }

    50% {
        transform: translate3d(0, -40px, 0) rotate(5deg);
        opacity: 0.8;
    }

    100% {
        transform: translate3d(var(--target-x, 0px), var(--target-y, 0px), 0) rotate(0deg);
        opacity: 1;
    }
}

.tile-exposing {
    animation: tile-expose 300ms ease-out forwards;
}

/* ===== Invalid Action Animation ===== */
@keyframes shake {

    0%,
    100% {
        transform: translateX(0);
    }

    10%,
    30%,
    50%,
    70%,
    90% {
        transform: translateX(-5px);
    }

    20%,
    40%,
    60%,
    80% {
        transform: translateX(5px);
    }
}

.invalid-action {
    animation: shake 500ms ease-in-out;
    border-color: #f44336 !important;
}

/* ===== Custom Easing Functions ===== */
:root {
    --ease-smooth: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    --ease-gentle: cubic-bezier(0.4, 0.0, 0.2, 1);
    --ease-snappy: cubic-bezier(0.4, 0.0, 1, 1);
}

/* ===== Performance Optimization ===== */
.tile-drawing,
.tile-discarding,
.tile-claiming-pulse,
.tile-claiming-move,
.tile-exposing {
    will-change: transform, opacity, filter;
    transform: translateZ(0);
    contain: layout style paint;
}

.turn-starting,
.turn-ending {
    will-change: border-left-width, box-shadow;
    contain: layout style paint;
}

@media (prefers-reduced-motion: reduce) {

    .tile-drawing,
    .tile-discarding,
    .tile-claiming-pulse,
    .tile-claiming-move,
    .tile-exposing,
    .turn-starting,
    .turn-ending,
    .hand-sorting .mobile-tile,
    .invalid-action {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* ===== Home Page Tiles Animation ===== */
.home-page-tiles-container {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10;
    pointer-events: none;
    overflow: hidden; /* Clip tiles at screen edges - funnel effect */
}

.home-page-tile {
    position: absolute;
    will-change: transform;
    transform: translateZ(0);
    /* Force GPU acceleration */
    /* Transition is set dynamically in JavaScript for precise control */
}

/* ===== Tile Deal Animation (for initial dealing sequence) ===== */
@keyframes tile-deal {
    0% {
        transform: translate3d(var(--start-x, 0px), var(--start-y, 0px), 0) scale(0.5);
        opacity: 0;
    }

    70% {
        transform: translate3d(
            calc(var(--start-x, 0px) + var(--movement-dx, 0px) * 0.8),
            calc(var(--start-y, 0px) + var(--movement-dy, 0px) * 0.8),
            0
        ) scale(1.05);
        opacity: 0.9;
    }

    100% {
        transform: translate3d(var(--end-x, 0px), var(--end-y, 0px), 0) scale(1);
        opacity: 1;
    }
}

.tile-dealing {
    animation: tile-deal var(--tile-deal-duration, 400ms) var(--tile-deal-easing, ease-out) forwards;
    transform-style: preserve-3d;
    backface-visibility: hidden;
}

/* ===== Opponent Tiles Fade Out (after dealing round completes) ===== */
@keyframes tile-fade-out {
    0% {
        opacity: 1;
        transform: scale(1);
    }

    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

.tile-fading-out {
    animation: tile-fade-out 300ms ease-in forwards;
}